<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRVå ±å‘Šæƒæåˆ†æç³»çµ±</title>
    <script src="jsQR.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #374151; font-size: 1.8em; margin-bottom: 10px; }
        .header p { color: #6b7280; }
        
        .nav-tabs {
            display: flex;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
        }
        .nav-tab {
            flex: 1;
            padding: 15px;
            background: #f9fafb;
            border: none;
            cursor: pointer;
            color: #6b7280;
            transition: all 0.3s;
        }
        .nav-tab.active { background: white; color: #374151; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .scan-section {
            background: #f9fafb;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .barcode-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 1.1em;
            margin: 15px 0;
        }
        
        .scan-btn {
            background: #6b7280;
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 1em;
        }
        .scan-btn:hover { background: #4b5563; }
        .demo-btn { background: #A0AFB7; }
        .demo-btn:hover { background: #6A818D; }
        
        #status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            background: #f3f4f6;
            color: #6b7280;
        }
        #status.success { background: #dcfce7; color: #166534; }
        #status.error { background: #fef2f2; color: #dc2626; }
        
        .results {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-top: 20px;
        }
        .results.show { display: block; }
        
        .parameters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .param-card {
            background: white;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }
        .param-card h4 { color: #374151; margin-bottom: 10px; }
        .param-card .value { font-size: 1.8em; font-weight: bold; color: #111827; }
        .param-card .unit { font-size: 0.8em; color: #6b7280; }
        .param-card.normal .value { color: #599CBF; }  /* ç¶ è‰²æ–‡å­— */
        .param-card.warning .value { color: #B29868; } /* é»ƒè‰²æ–‡å­— */
        .param-card.danger .value { color: #FF7B5E; }  /* ç´…è‰²æ–‡å­— */
        
        .analysis-result {
            background: #f3f4f6;
            padding: 35px 30px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
            min-height: 120px;
        }
        .analysis-result h3 { font-size: 1.3em; margin-bottom: 10px; }
        
        .recommendations {
            background: #fafafa;
            padding: 20px;
            border-radius: 8px;
        }
        .recommendations h4 { margin-bottom: 15px; color: #374151; }
        .recommendations ul { list-style: none; }
        .recommendations li {
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
            color: #6b7280;
            line-height: 1.5;
        }
        .recommendations li:before { content: "â€¢ "; color: #10b981; font-weight: bold; }
        
        .settings-section { margin-bottom: 30px; }
        .settings-section h3 {
            color: #374151;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .range-input-group {
            display: grid;
            grid-template-columns: 1fr 100px 100px 150px;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
        }
        .range-input { padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; }
        
        .classification-section { margin-bottom: 30px; }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        .add-classification-btn {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 16px;
            cursor: pointer;
        }
        
        .classification-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .classification-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .delete-btn {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
        }
        
        /* æ–°å¢ï¼šHRVåƒæ•¸è¼¸å…¥è¡¨å–®æ¨£å¼ */
        .hrv-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin: 15px 0;
        }

        .hrv-form-header {
            text-align: center;
            margin-bottom: 20px;
            color: #374151;
            font-weight: 600;
        }

        .hrv-input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 40px;
            justify-content: center; /* è®“é …ç›®å±…ä¸­ */
        }

        .hrv-input-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            flex-wrap: wrap; 
        }

        .hrv-input-label {
            min-width: 50px;
            font-weight: 600;
            color: #374151;
            font-size: 0.95em;
        }

        .hrv-input-field {
            flex: 1;
            padding: 10px 10px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 1em;
            text-align: center;
            transition: border-color 0.3s;
            min-width: 80px;  /* è¨­å®šæœ€å°å¯¬åº¦é¿å…éå° */
            max-width: 100%;
        }

        .hrv-input-field:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .hrv-input-unit {
            min-width: 35px;
            color: #6b7280;
            font-size: 0.9em;
            text-align: left;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #6b7280; }
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
        }
        .form-textarea { min-height: 80px; resize: vertical; }
        
        .suggestions-list { margin-top: 10px; }
        .suggestion-item {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
        }
        .suggestion-input { flex: 1; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; }
        .remove-btn {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
            border-radius: 4px;
            padding: 6px 8px;
            cursor: pointer;
        }
        .add-btn {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            margin-top: 8px;
        }
        
        .save-btn {
            background: #10b981;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        .reset-btn { background: #ef4444; }
        
        .disclaimer {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            color: #7f1d1d;
            text-align: center;
        }

        /* æ–°å¢æ¨£å¼ */
        .input-method-tabs {
            display: flex;
            background: #f3f4f6;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #d1d5db;
        }
        .method-tab {
            flex: 1;
            padding: 12px;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
            color: #6b7280;
            transition: all 0.3s;
            border-radius: 8px;
        }
        .method-tab.active { background: #4C8CC2; color: white; }
        .method-tab:hover { background: #e5e7eb; }
        .method-tab.active:hover { background: #28689c
; }

        .input-section { display: none; margin: 15px 0; }
        .input-section.active { display: block; }

        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
            margin: 15px 0;
        }
        .upload-area:hover {
            border-color: #6FA2CE;
            background: #ebebeb;
        }
        .upload-area.dragover {
            border-color: #6FA2CE;
            background: #ebebeb;
        }

        .upload-content {
            color: #6b7280;
        }
        .upload-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }
        .upload-hint {
            font-size: 0.9em;
            color: #9ca3af;
            margin-top: 5px;
        }

        .image-preview {
            margin-top: 15px;
            text-align: center;
        }
        .image-preview img {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }
        .preview-info {
            margin-top: 10px;
            padding: 10px;
            background: #f9fafb;
            border-radius: 6px;
            font-size: 0.9em;
            color: #6b7280;
        }

        .processing-status {
            margin: 15px 0;
            padding: 12px;
            border-radius: 6px;
            background: #fffbeb;
            border: 1px solid #fde68a;
            color: #92400e;
            text-align: center;
        }
        .processing-status.success {
            background: #dcfce7;
            border-color: #86efac;
            color: #166534;
        }
        .processing-status.error {
            background: #fef2f2;
            border-color: #fca5a5;
            color: #dc2626;
        }
    
        /* åå­—è±¡é™åœ–æ¨£å¼ - å®Œå…¨éŸ¿æ‡‰å¼ç‰ˆæœ¬ */
        .chart-container-responsive {
            width: 100%;
            max-width: 500px;
            margin: 20px auto 80px auto;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 20px;
        }

        .quadrant-chart {
            width: min(85vw, 400px);
            height: min(85vw, 400px);
            position: relative;
            border-radius: 15px;
            overflow: visible !important;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            margin: 50px auto;
            z-index: 5;
        }

        .quadrant-background {
            width: 100%;
            height: 100%;
            position: relative;
            border-radius: 15px;
            background: linear-gradient(45deg, 
                #C1CDD3 0%, #C1CDD3 20%, #D2D5D3 33%, #E2DDD4 40%, 
                #E2DDD4 60%, #F1DBD2 66%, #FFD9D1 80%, #FFD9D1 100%
            );
        }

        /* åº§æ¨™è»¸ */
        .axis {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            z-index: 5;
            display: none;
        }

        .axis-horizontal {
            width: 100%;
            height: 2px;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
        }

        .axis-vertical {
            width: 2px;
            height: 100%;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
        }
        
        .x-axis-arrow, .y-axis-arrow {
            z-index: 10;  /* æé«˜å±¤ç´š */
            overflow: visible;  /* ç¢ºä¿ç®­é ­ä¸è¢«è£åˆ‡ */
        }

        /* è»¸æ¨™ç±¤ */
        .y-axis-label {
            position: absolute;
            right: calc(100% - 10.7px);
            left: -90px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            font-size: 18.7px;
            font-weight: 600;
            color: #6e6e6e;
            white-space: nowrap;
        }

        .y-axis-arrow {
            position: absolute;
            bottom: -70px;
            left: -40px;
            top: 0;
            bottom: -34px;
            width: 2px;
            background: #929292;
            background: linear-gradient(
                to top,
                #929292 0%,
                #929292 37%,
                transparent 37%,
                transparent 78%,  /* ä¸­é–“æ–‡å­—å€åŸŸé€æ˜ */
                #929292 78%,
                #929292 100%
            );
        }

        .y-axis-arrow::before {
            content: '';
            position: absolute;
            top: -1;
            left: -6px;
            width: 0;
            height: 0;
            border-bottom: 12px solid #929292;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
        }

        .x-axis-label {
            position: absolute;
            bottom: -49px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18.7px;
            font-weight: 600;
            color: #6e6e6e;
            text-align: center;
        }

        .x-axis-arrow {
            position: absolute;
            bottom: -40px;
            left: -34px;
            right: 0;
            height: 2px;
            background: #929292;
            background: linear-gradient(
                to right,
                #929292 0%,
                #929292 33%,
                transparent 33%,
                transparent 78%,  /* ä¸­é–“æ–‡å­—å€åŸŸé€æ˜ */
                #929292 78%,
                #929292 100%
            );
        }

        .x-axis-arrow::after {
            content: '';
            position: absolute;
            right: -1;
            top: -4px;
            width: 0;
            height: 0;
            border-left: 12px solid #929292;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        .axis-origin {
            position: absolute;
            bottom: -45px;
            left: -45px;
            width: 12px;
            height: 12px;
            border: 3px solid #929292;
            border-radius: 50%;
            background: #929292;
            z-index: 10;
        }

        /* æ•¸æ“šé» */
        .data-point {
            position: absolute;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 5px solid #4C8CC2;
            transform: translate(-50%, -50%);
            z-index: 10;
            box-shadow: 0 2px 6px rgba(76, 140, 194, 0.3);
            transition: all 0.3s ease;
        }

        .data-point.primary {
            animation: pulse 2s infinite;
        }

        .data-point.secondary {
            opacity: 0.5;
            transform: translate(-50%, -50%) scale(0.7);
            border-color: #94a3b8;
            animation: none;
        }

        @keyframes pulse {
            0% { 
                box-shadow: 0 2px 6px rgba(76, 140, 194, 0.3), 0 0 0 0 rgba(76, 140, 194, 0.7); 
            }
            70% { 
                box-shadow: 0 2px 6px rgba(76, 140, 194, 0.3), 0 0 0 10px rgba(76, 140, 194, 0); 
            }
            100% { 
                box-shadow: 0 2px 6px rgba(76, 140, 194, 0.3), 0 0 0 0 rgba(76, 140, 194, 0); 
            }       
        }
        
        .analysis-result .chart-container-responsive {
            width: 100%;
            max-width: 350px;
            margin: 50px auto 50px auto;  /* åˆ†æçµæœä¸­ä¹Ÿå¢åŠ ä¸‹æ–¹ç©ºé–“ */
            padding-bottom: 10px;
        }

        .analysis-result .quadrant-chart {
            width: min(60vw, 280px);
            height: min(60vw, 280px);
            margin: 15px auto;
        }
        
/* æ‰‹æ©ŸéŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 768px) {
    .container {
        padding: 10px;
        margin: 10px;
    }
    
    /* æˆ–è€…æ›´ç²¾ç¢ºçš„é¸æ“‡å™¨ï¼Œéš±è—åŒ…å«æ¨™é¡Œçš„é‚£ä¸€è¡Œ */
    .range-input-group:not([data-param]) {
        display: none !important;
    }

    .range-input-group {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 15px;
        background: #f9fafb;
        border-radius: 8px;
    }
    
    /* åƒæ•¸åç¨±æ¨™é¡Œ */
    .param-title {
        font-size: 1.1em;
        font-weight: bold;
        color: #374151;
        margin-bottom: 12px;
        padding-bottom: 6px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    /* æ•¸å€¼è¼¸å…¥å€åŸŸ */
    .value-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 10px;
    }
    
    .input-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    
    .input-label {
        font-size: 0.85em;
        font-weight: 600;
        color: #6b7280;
    }
    
    .range-input {
        width: 100%;
        padding: 10px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 1em;
        text-align: center;
    }
    
    /* èªªæ˜è¼¸å…¥å€åŸŸ */
    .description-input {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    
    .description-input .range-input {
        text-align: left;
        font-size: 0.9em;
    }
    
    .range-input:focus {
        border-color: #10b981;
        outline: none;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }
    
    .range-input-group label {
        font-weight: bold;
        color: #374151;
        margin-bottom: 5px;
    }
    
    .range-input {
        width: 100%;
        padding: 10px;
    }
    
    /* åƒæ•¸å¡ç‰‡ä¹Ÿè¦èª¿æ•´ */
    .parameters {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 8px;
    }
    
    .param-card {
        padding: 12px;
    }
    
    /* å»ºè­°åˆ—è¡¨èª¿æ•´ */
    .suggestion-item {
        flex-direction: column;
        gap: 5px;
    }
    
    .remove-btn {
        align-self: flex-start;
        width: fit-content;
    }
    
    /* æŒ‰éˆ•èª¿æ•´ */
    .scan-btn {
        padding: 12px 20px;
        margin: 3px;
        font-size: 0.9em;
    }
    
    /* åˆ†é¡é …ç›®èª¿æ•´ */
    .classification-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    /* ç‹€æ…‹é¡¯ç¤ºèª¿æ•´ */
    #status {
        font-size: 0.9em;
        padding: 10px;
    }

    /* æ‰‹æ©Ÿç‰ˆHRVè¼¸å…¥è¡¨å–® */
    .hrv-input-grid {
        display: grid !important;
        grid-template-columns: 1fr !important; /* å¼·åˆ¶å–®åˆ— */
        gap: 10px !important;
        margin-bottom: 20px;
    }

    .hrv-input-item {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        padding: 8px !important;
        gap: 6px !important;
        background: #f8fafc;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
        width: 100%;
        min-width: 0; /* é‡è¦ï¼šå…è¨±æ”¶ç¸® */
    }

    .hrv-input-label {
        min-width: 45px !important;
        font-weight: 600;
        color: #374151;
        font-size: 0.85em !important;
        flex-shrink: 0;
    }

    .hrv-input-field {
        flex: 1 !important;
        padding: 6px !important;
        border: 2px solid #d1d5db;
        border-radius: 4px;
        font-size: 0.9em !important;
        text-align: center;
        min-width: 0 !important;
        width: auto !important;
    }

    .hrv-input-unit {
        min-width: 25px !important;
        color: #6b7280;
        font-size: 0.8em !important;
        text-align: left;
        flex-shrink: 0;
    }

    .chart-container-responsive {
        max-width: 95vw;
        margin: 15px auto 80px auto;
        padding-bottom: 40px; 
    }
    
    .quadrant-chart {
        width: min(85vw, 300px);
        height: min(85vw, 300px);
        margin: 20px auto 0 auto;     /* ç§»é™¤ä¸‹æ–¹marginï¼Œç”±å®¹å™¨æ§åˆ¶ */
        position: relative;
    }
    
    .y-axis-label {
        font-size: 14px;
        left: -65px;     /* å¢åŠ å·¦å´ç©ºé–“ */
        top: 50%;
        transform: translateY(-50%) rotate(-90deg);
        z-index: 15;
    }
    
    .x-axis-label {
        font-size: 14px;
        bottom: -33px;   /* å¢åŠ ä¸‹æ–¹ç©ºé–“ */
        left: 50%;
        transform: translateX(-50%);
        z-index: 15;
    }
    
    .x-axis-arrow {
        bottom: -25px;  /* å›ºå®šä½ç½® */
        left: -25px;    /* èª¿æ•´èµ·å§‹ä½ç½® */
        right: 0;
        height: 1px;
        background: linear-gradient(
            to right,
            #929292 0%,
            #929292 33%,      /* ç¸®çŸ­èµ·å§‹æ®µ */
            transparent 33%,
            transparent 78%,  /* æ“´å¤§æ–‡å­—å€åŸŸ */
            #929292 78%,
            #929292 100%
        );
    }
    
    .x-axis-arrow::after {
        right: -1px;
        top: -6px;
        border-left: 12px solid #929292;
        border-top: 6px solid transparent;
        border-bottom: 6px solid transparent;
        z-index: 15;
    }

    .y-axis-arrow {
        left: -27px;    /* å›ºå®šä½ç½® */
        top: 0;
        bottom: -25px;  /* èª¿æ•´åº•éƒ¨ä½ç½® */
        width: 1px;
        background: linear-gradient(
            to top,
            #929292 0%,
            #929292 38%,      /* ç¸®çŸ­èµ·å§‹æ®µ */
            transparent 38%,
            transparent 75%,  /* æ“´å¤§æ–‡å­—å€åŸŸ */
            #929292 75%,
            #929292 100%
        );
    }
        
    .y-axis-arrow::before {
        top: -1px;
        left: -6px;
        border-bottom: 12px solid #929292;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        z-index: 15;
    }

    .axis-origin {
        width: 8px;
        height: 8px;
        border: 2px solid #929292;
        bottom: -27px;   /* èˆ‡Xè»¸å°é½Š */
        left: -30px;     /* èˆ‡Yè»¸å°é½Š */
        background: #929292;
        z-index: 10;
    }

    .data-point {
        width: 24px;
        height: 24px;
        border-width: 4px;
    }

    .data-point.secondary {
        transform: translate(-50%, -50%) scale(0.8); /* ä¿æŒæ¬¡è¦é»çš„æ¯”ä¾‹ */
    }

    .analysis-result .chart-container-responsive {
        max-width: 90vw;
        margin: 12px auto 60px auto;  /* åˆ†æçµæœä¸­ä¹Ÿå¢åŠ ä¸‹æ–¹ç©ºé–“ */
        padding-bottom: 30px
    }
    
    .analysis-result .quadrant-chart {
        width: min(65vw, 220px);
        height: min(65vw, 220px);
        margin: 10px auto 0 auto;
    }
}

@media (max-width: 1024px) and (min-width: 769px) {
    .hrv-input-field {
        min-width: 120px;
        max-width: 180px;
    }
}

@media (max-width: 480px) {
    .header h1 {
        font-size: 1.5em;
    }
    
    .nav-tab {
        padding: 12px 8px;
        font-size: 0.9em;
    }
    
    .parameters {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }
    
    .scan-section {
        padding: 15px;
    }

    .hrv-input-label {
        min-width: 50px;
        font-size: 0.85em;
    }

    .hrv-input-field {
        font-size: 0.85em !important;
        padding: 5px !important;
    }

    .hrv-input-unit {
        min-width: 35px;
        font-size: 0.8em;
    }

    .chart-container-responsive {
        margin: 10px auto 70px auto;
        padding-bottom: 35px;
    }
    
    .quadrant-chart {
        margin: 15px auto 0 auto;
    }
    
    
    .y-axis-label {
        font-size: 12px;
        left: -50px;
    }
    
    .x-axis-label {
        font-size: 12px;
        bottom: -25px;
    }
    
    .x-axis-arrow {
        bottom: -20px;
        left: -20px;
    }
    
    .y-axis-arrow {
        left: -20px;
        bottom: -20px;
    }

    .x-axis-arrow::after {
        right: -1px;
        top: -5px;
        border-left: 10px solid #929292;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
        z-index: 15;
    }
    
    .y-axis-arrow::before {
        top: -1px;
        left: -5px;
        border-bottom: 10px solid #929292;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        z-index: 15;
    }

    .axis-origin {
        width: 6px;      /* æ›´å°æ‰‹æ©Ÿæ›´å° */
        height: 6px;
        border: 1.5px solid #929292;
        bottom: -22px;
        left: -22px;
    }

    .data-point {
        width: 20px;
        height: 20px;
        border-width: 3px;
    }

    .analysis-result .chart-container-responsive {
        margin: 8px auto 50px auto;
        padding-bottom: 25px;
    }
    
    .analysis-result .quadrant-chart {
        margin: 8px auto 0 auto;
    }

}

/* åœ¨é€™è£¡æ–°å¢HRVåˆ†ç´šç›¸é—œçš„CSS */
.hrv-grading-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.toggle-switch {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}

.toggle-label {
    font-weight: 600;
    color: #374151;
}

.grading-info {
    background: #fffbeb;
    padding: 15px;
    border-radius: 6px;
    margin: 15px 0;
    border-left: 4px solid #f59e0b;
}

.grading-info ol {
    margin-left: 20px;
    color: #92400e;
}

.hrv-grade-item {
    border-left: 4px solid #6366f1;
}

.parameter-ranges {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
    margin-top: 10px;
}

.param-range {
    background: #f9fafb;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 0.9em;
    border: 1px solid #e5e7eb;
}

/* åœ¨é€™è£¡æ–°å¢HRVåˆ†ç´šçµæœçš„æ¨£å¼ */
.hrv-grading-result {
    margin: 15px 0;
    padding: 15px;
    border-radius: 6px;
    border-left: 4px solid;
}

.hrv-grading-result h4 {
    margin-bottom: 10px;
    font-size: 1.1em;
}

.hrv-grading-result p {
    margin-bottom: 5px;
    line-height: 1.4;
}

    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¬ HRVå ±å‘Šæƒæåˆ†æç³»çµ±</h1>
            <p>æƒæå ±å‘Šä¸Šçš„QR Codeï¼Œç«‹å³ç²å¾—å€‹äººåŒ–åˆ†æçµæœ</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('scanner')">ğŸ“± æƒæåˆ†æ</button>
            <button class="nav-tab" onclick="switchTab('settings')">âš™ï¸ è‡ªè¨‚è¨­å®š</button>
        </div>

        <div id="scanner-tab" class="tab-content active">
            <div class="scan-section">
                <label>ğŸ” é¸æ“‡æƒææ–¹å¼ï¼š</label>
                
                <!-- è¼¸å…¥æ–¹å¼é¸æ“‡ -->
                <div class="input-method-tabs">
                    <button class="method-tab active" onclick="switchInputMethod('manual')">âœï¸ æ‰‹å‹•è¼¸å…¥</button>
                    <button class="method-tab" onclick="switchInputMethod('qrcode')">ğŸ“± QR Codeæƒæ</button>
                </div>

                <!-- æ‰‹å‹•è¼¸å…¥å€åŸŸ -->
                <div id="manual-input" class="input-section active">
                    <input type="text" id="barcodeInput" style="display: none;">

                    <div class="hrv-form">
                        <div class="hrv-form-header">
                            è«‹è¼¸å…¥å„é …HRVåƒæ•¸æ•¸å€¼
                        </div>
                        <div class="hrv-input-grid">
                            <div class="hrv-input-item">
                                <label class="hrv-input-label">SDNN</label>
                                <input type="number" class="hrv-input-field" id="input-SDNN" step="0.1" placeholder="è«‹è¼¸å…¥">
                                <span class="hrv-input-unit">ms</span>
                            </div>
                            <div class="hrv-input-item">
                                <label class="hrv-input-label">rMSSD</label>
                                <input type="number" class="hrv-input-field" id="input-RMSSD" step="0.1" placeholder="è«‹è¼¸å…¥">
                                <span class="hrv-input-unit">ms</span>
                            </div>
                            <div class="hrv-input-item">
                                <label class="hrv-input-label">LF</label>
                                <input type="number" class="hrv-input-field" id="input-LF" step="0.1" placeholder="è«‹è¼¸å…¥">
                                <span class="hrv-input-unit">msÂ²</span>
                            </div>
                            <div class="hrv-input-item">
                                <label class="hrv-input-label">HF</label>
                                <input type="number" class="hrv-input-field" id="input-HF" step="0.1" placeholder="è«‹è¼¸å…¥">
                                <span class="hrv-input-unit">msÂ²</span>
                            </div>
                            <div class="hrv-input-item">
                                <label class="hrv-input-label">LFHF</label>
                                <input type="number" class="hrv-input-field" id="input-LFHF" step="0.1" placeholder="è«‹è¼¸å…¥">
                                <span class="hrv-input-unit"></span>
                            </div>
                            <div class="hrv-input-item">
                                <label class="hrv-input-label">pNN50</label>
                                <input type="number" class="hrv-input-field" id="input-pNN50" step="0.1" placeholder="è«‹è¼¸å…¥">
                                <span class="hrv-input-unit">%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QR Codeä¸Šå‚³å€åŸŸ -->
                <div id="qrcode-input" class="input-section">
                    <label>ä¸Šå‚³QR Codeåœ–ç‰‡ï¼š</label>
                    <div class="upload-area" onclick="document.getElementById('qrcodeFile').click()">
                        <div class="upload-content">
                            <div class="upload-icon">ğŸ“±</div>
                            <div>é»æ“Šä¸Šå‚³QR Codeåœ–ç‰‡</div>
                            <div class="upload-hint">æ”¯æ´ JPG, PNG, GIF æ ¼å¼</div>
                        </div>
                    </div>
                    <input type="file" id="qrcodeFile" accept="image/*" style="display: none;" onchange="processQRCodeImage(this)">
                    <div id="qrcodePreview" class="image-preview"></div>
                </div>

                <div id="status">âœï¸ æ‰‹å‹•è¼¸å…¥æ¨¡å¼</div>
                
                <div class="form-actions">
                    <button class="scan-btn" onclick="analyzeData()">ğŸ” åˆ†æå ±å‘Š</button>
                    <button class="scan-btn demo-btn" onclick="loadDemo()">ğŸ“‹ è¼‰å…¥ç¤ºç¯„æ•¸æ“š</button>
                    <button class="scan-btn" onclick="clearInput()">ğŸ—‘ï¸ æ¸…é™¤</button>
                </div>
            </div>

            <div id="results" class="results">
                <div class="result-header">
                    <h2 style="margin-bottom: 20px; line-height: 1.1;">ğŸ“Š åˆ†æçµæœ</h2>
                    <p style="margin-bottom: 25px; line-height: 1;">åŸºæ–¼æ‚¨çš„HRVåƒæ•¸é€²è¡Œçš„è‡ªå¾‹ç¥ç¶“åŠŸèƒ½è©•ä¼°</p>
                </div>
                <div id="parameters" class="parameters"></div>
                <div id="analysisResult" class="analysis-result"></div>
                <div class="recommendations">
                    <h4>ğŸ’¡ å€‹äººåŒ–å»ºè­°</h4>
                    <ul id="recommendationsList"></ul>
                </div>
                <div class="disclaimer">
                    <strong>âš ï¸ é‡è¦è²æ˜ï¼š</strong>
                    æœ¬åˆ†æçµæœåƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆé†«ç™‚è¨ºæ–·ã€‚å¦‚æœ‰å¥åº·ç–‘æ…®ï¼Œè«‹è«®è©¢å°ˆæ¥­é†«ç™‚äººå“¡ã€‚
                </div>
            </div>
        </div>

        <div id="settings-tab" class="tab-content">
            <div class="settings-section">
                <h3>ğŸ“Š HRVåƒæ•¸æ­£å¸¸ç¯„åœè¨­å®š</h3>
                <div class="range-input-group">
                    <label>åƒæ•¸åç¨±</label>
                    <label>æœ€å°å€¼</label>
                    <label>æœ€å¤§å€¼</label>
                    <label>èªªæ˜</label>
                </div>
                <div id="parameterRanges"></div>
            </div>

            <div class="classification-section">
                <div class="section-header">
                    <h3>ğŸ·ï¸ åˆ†é¡æ¨™æº–èˆ‡å»ºè­°è¨­å®š</h3>
                </div>
                <div id="classificationList"></div>
            </div>

            <div class="settings-section">
                <button class="save-btn" onclick="saveSettings()">ğŸ’¾ å„²å­˜è¨­å®š</button>
                <button class="save-btn reset-btn" onclick="resetToDefault()">ğŸ”„ æ¢å¾©é è¨­</button>
            </div>
        </div>
    </div>

    <script>
        let systemSettings = {
            parameterRanges: {
                'RMSSD': { min: 30, max: 100, description: 'é€£çºŒå¿ƒè·³é–“éš”å·®ç•°' },
                'pNN50': { min: 10, max: 50, description: 'å¿ƒè·³è®Šç•°ç¨‹åº¦' },
                'LF': { min: 300, max: 1500, description: 'ä½é »åŠŸç‡' },
                'HF': { min: 300, max: 1000, description: 'é«˜é »åŠŸç‡' },
                'LFHF': { min: 0.5, max: 2.5, description: 'è‡ªå¾‹ç¥ç¶“å¹³è¡¡' },
                'SDNN': { min: 50, max: 150, description: 'å¿ƒè·³è®Šç•°æ¨™æº–å·®' }
            },

            hrvGrading: {
                enabled: true,
                grades: {
                    grade1: {
                        name: 'æ¥µä½³æ¢å¾©ç‹€æ³',
                        rmssdRange: { min: 75, max: Infinity },
                        conditions: {
                            LFHF: { min: 0.3, max: 0.8 },
                            pNN50: { min: 30, max: Infinity }
                        },
                        color: '#599CBF',
                        recommendations: ['å‡è¡¡ç‡Ÿé¤Šï¼šæ¶µè“‹æ°´æº¶ï¼è„‚æº¶æ€§å¤šç¨®ç¶­ä»–å‘½åŠé‡è¦ç¤¦ç‰©è³ªã€‚', 'ç´°èƒä¿®å¾©ï¼šåŠ å¼·å°æŠ—è‡ªç”±åŸºçš„èƒ½åŠ›ï¼Œæ”¯æŒçµ„ç¹”å†ç”Ÿã€‚']
                    },
                    grade2: {
                        name: 'è‰¯å¥½å¹³è¡¡ç‹€æ³',
                        rmssdRange: { min: 45, max: 75 },
                        conditions: {
                            LFHF: { min: 0.8, max: 2.0 },
                            pNN50: { min: 15, max: 30 }
                        },
                        color: '#82CEDB',  // æ”¹ç‚ºç°è—è‰²
                        recommendations: ['èƒ½é‡æ”¯æŒï¼šå¹«åŠ©æå‡æ—¥å¸¸æ´»å‹•æ‰€éœ€çš„æ´»åŠ›ã€‚', 'åŸºç¤ä»£è¬ï¼šç¶­æŒé«”å…§èƒ½é‡ç”¢ç”Ÿèˆ‡æ¶ˆè€—çš„å¹³è¡¡ã€‚']
                    },
                    grade3: {
                        name: 'è¼•åº¦ç–²å‹ç‹€æ…‹',
                        rmssdRange: { min: 25, max: 45 },
                        conditions: {
                            LFHF: { min: 1.5, max: 3.0 },
                            pNN50: { min: 10, max: 20 }
                        },
                        color: '#B29868',  // æ”¹ç‚ºå¡å…¶è‰²
                        recommendations: ['å¾ªç’°ä¿ƒé€²ï¼šæ”¹å–„å¾®å¾ªç’°ï¼Œè®“æ°§æ°£èˆ‡é¤Šåˆ†æ›´æœ‰æ•ˆåœ°é‹é€è‡³å…¨èº«ã€‚', 'ä»£è¬å”åŠ©ï¼šå”åŠ©ç¶­æŒå¥åº·çš„èƒ½é‡ç”Ÿç”¢èˆ‡åˆ©ç”¨ã€‚']
                    },
                    grade4: {
                        name: 'ä¸­åº¦å£“åŠ›ç‹€æ…‹',
                        rmssdRange: { min: 19, max: 30 },
                        conditions: {
                            LFHF: { min: 2.5, max: 4.0 },
                            pNN50: { min: 6, max: 10 }
                        },
                        color: '#E2D5BC',  // æ”¹ç‚ºåœŸè‰²
                        recommendations: ['èº«å¿ƒæ”¾é¬†ï¼šé€éèˆ’ç·©æ•ˆæœï¼Œæ¸›å°‘è‚Œè‚‰èˆ‡ç²¾ç¥ç·Šå¼µã€‚', 'æƒ…ç·’èˆ’ç·©ï¼šæ”¯æŒå¿ƒç†çš„ç©©å®šèˆ‡æ­£å‘èª¿ç¯€ã€‚']
                    },
                    grade5: {
                        name: 'é«˜åº¦å£“åŠ›ç‹€æ…‹',
                        rmssdRange: { min: 12, max: 19 },
                        conditions: {
                            LFHF: { min: 3.5, max: 6.0 },
                            pNN50: { min: 3, max: 6 }
                        },
                        color: '#FFB4A3',  // æ”¹ç‚ºæ·ºç²‰è‰²
                        recommendations: ['ç¥ç¶“ç©©å®šï¼šç¶­æŒç¥ç¶“ç´°èƒåŠŸèƒ½èˆ‡å¤§è…¦å¥åº·ã€‚', 'å£“åŠ›é©æ‡‰ï¼šæå‡å°æ€¥æ€§æˆ–æ…¢æ€§å£“åŠ›çš„è€å—åŠ›ã€‚']
                    },
                    grade6: {
                        name: 'æ¥µåº¦å£“åŠ›ç‹€æ…‹',
                        rmssdRange: { min: 0, max: 12 },
                        conditions: {
                            LFHF: [{ min: 6.0, max: Infinity }, { min: 0, max: 0.3 }],
                            pNN50: { min: 0, max: 3 }
                        },
                        color: '#FF7B5E',  // æ”¹ç‚ºçŠç‘šç´…è‰²
                        recommendations: ['æ·±åº¦ä¿®å¾©ï¼šæä¾›æ›´å¼·çš„ç´°èƒå±¤ç´šä¿®è­·èˆ‡æ•´é«”æ©Ÿèƒ½æ¢å¾©ã€‚', 'å…ç–«å”èª¿ï¼šåŒæ™‚æ”¯æŒå…ç–«ç³»çµ±èˆ‡èº«å¿ƒå¥åº·çš„å¹³è¡¡ã€‚']
                    }
                }
            }
        };

        let currentInputMethod = 'manual';

        function switchInputMethod(method) {
            currentInputMethod = method;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.method-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // æ›´æ–°è¼¸å…¥å€åŸŸé¡¯ç¤º
            document.querySelectorAll('.input-section').forEach(section => section.classList.remove('active'));
            document.getElementById(method + '-input').classList.add('active');
            
            clearAllData();

            // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
            const statusMessages = {
                manual: 'âœï¸ æ‰‹å‹•è¼¸å…¥æ¨¡å¼',
                qrcode: 'ğŸ“± QR Codeæƒææ¨¡å¼ - è«‹ä¸Šå‚³åœ–ç‰‡'
            };
            
            document.getElementById('status').textContent = statusMessages[method];
            document.getElementById('status').className = '';
        }

        // åå­—è±¡é™åœ–ç›¸é—œå‡½å¼
        function calculateChartPosition(gradeIndex, lfhfValue) {
            // Xè»¸ä½ç½®ï¼šç´šåˆ¥1åœ¨å·¦å´ï¼Œç´šåˆ¥6åœ¨å³å´
            const xPercent = 15 + ((gradeIndex - 1) / 5) * 70;
    
            // Yè»¸ä½ç½®ï¼šè‡ªå¾‹ç¥ç¶“å¹³è¡¡ - æ ¹æ“šLFHFå€¼çš„å¥åº·ç¨‹åº¦
            let yPercent;

            if (lfhfValue >= 0.3 && lfhfValue <= 0.8) {
                // æœ€ä½³ç¯„åœï¼šåœ–è¡¨ä¸­å¤® 45-55%
                yPercent = 50;
            } else if (lfhfValue > 0.8 && lfhfValue <= 2.0) {
                // è‰¯å¥½ç¯„åœï¼šç¨å¾®åé›¢ä¸­å¿ƒ 35-40%
                yPercent = 37.5;
            } else if (lfhfValue > 1.5 && lfhfValue <= 3.0) {
                // è¼•åº¦ç•°å¸¸ï¼šæ›´åé›¢ 25-30%
                yPercent = 27.5;
            } else if (lfhfValue > 2.5 && lfhfValue <= 4.0) {
                // ä¸­åº¦ç•°å¸¸ï¼šæ˜é¡¯åé›¢ 15-20%
                yPercent = 17.5;
            } else if (lfhfValue > 3.5 && lfhfValue <= 6.0) {
                // é«˜åº¦ç•°å¸¸ï¼šæ¥è¿‘é‚Šç·£ 10%
                yPercent = 10;
            } else {
                // æ¥µåº¦ç•°å¸¸ï¼ˆ>6.0 æˆ– <0.3ï¼‰ï¼šé‚Šç·£ä½ç½® 5% æˆ– 95%
                yPercent = lfhfValue > 6.0 ? 5 : 95;
            }
    
            return { x: xPercent, y: yPercent };
        }

        function createDataPoint(gradeResult, lfhfValue, isPrimary = true) {
            const position = calculateChartPosition(gradeResult.gradeIndex, lfhfValue);
    
            const point = document.createElement('div');
            point.className = `data-point ${isPrimary ? 'primary' : 'secondary'}`;
            point.style.left = `${position.x}%`;
            point.style.top = `${position.y}%`;
    
            // æ ¹æ“šé¢¨éšªç­‰ç´šè¨­å®šé¡è‰²ï¼šé¢¨éšªè¶Šé«˜ï¼Œç´šåˆ¥æ•¸å­—è¶Šå¤§
            if (isPrimary) {
                // ä¸»è¦ç´šåˆ¥ï¼šå›ºå®šä½¿ç”¨ #4C8CC2
                point.style.borderColor = '#4C8CC2';
            } else {
                // æ¬¡è¦ç´šåˆ¥ï¼šä½¿ç”¨ #4C8CC2 çš„50%é€æ˜åº¦
                point.style.borderColor = '#4C8CC2';
                point.style.opacity = '0.5';
            }
    
            point.title = `${gradeResult.name} (ç´šåˆ¥${gradeResult.gradeIndex})`;
    
            return point;
        }

        function updateHRVChart(params, hrvGrading) {
            const chartContainer = document.getElementById('hrv-chart');
            const chart = chartContainer.querySelector('.quadrant-chart');

            // æ¸…é™¤ç¾æœ‰æ•¸æ“šé»
            const existingPoints = chart.querySelectorAll('.data-point');
            existingPoints.forEach(point => point.remove());

            if (hrvGrading && params.LFHF) {
                // é¡¯ç¤ºåœ–è¡¨
                chartContainer.style.display = 'block';
        
                // æ·»åŠ ä¸»è¦åˆ†ç´šæ•¸æ“šé»ï¼ˆé¢¨éšªæœ€åš´é‡çš„ï¼‰
                const primaryPoint = createDataPoint(hrvGrading.primary, params.LFHF, true);
                chart.appendChild(primaryPoint);
        
                // æ·»åŠ æ¬¡è¦åˆ†ç´šæ•¸æ“šé»ï¼ˆé¢¨éšªè¼ƒè¼•å¾®çš„ï¼‰
                if (hrvGrading.secondary && hrvGrading.secondary.length > 0) {
                    hrvGrading.secondary.forEach(grade => {
                        const secondaryPoint = createDataPoint(grade, params.LFHF, false);
                        chart.appendChild(secondaryPoint);
                    });
                }
            } else {
                // éš±è—åœ–è¡¨
                chartContainer.style.display = 'none';
            }
        }

        function processQRCodeImage(input) {
            const file = input.files[0];
            if (!file) return;
    
            updateStatus('ğŸ”„ æ­£åœ¨è™•ç†QR Codeåœ–ç‰‡...', 'processing');
    
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // æ›´æ–°é è¦½
                    const uploadArea = document.querySelector('#qrcode-input .upload-area');
                    if (uploadArea) {
                        uploadArea.innerHTML = `
                            <div class="upload-content">
                                <img src="${img.src}" alt="QR Codeé è¦½" style="max-width: 200px; max-height: 150px; border-radius: 6px; margin-bottom: 10px;">
                                <div style="font-size: 0.9em; color: #6b7280; margin-bottom: 5px;">${file.name}</div>
                                <div style="font-size: 0.8em; color: #9ca3af;">æ­£åœ¨è­˜åˆ¥ä¸­...</div>
                            </div>
                        `;
                    }
            
                    // çœŸæ­£çš„QRç¢¼è§£ç¢¼
                    decodeQRCode(img);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function decodeQRCode(img) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
    
            // ä½¿ç”¨åŸå§‹å°ºå¯¸ï¼Œä¸åšç¸®æ”¾è™•ç†
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
    
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
    
            const uploadArea = document.querySelector('#qrcode-input .upload-area');
    
            if (code) {
                const qrData = code.data;
                console.log('QRç¢¼å…§å®¹:', qrData);
        
                // æš«æ™‚è·³éæ ¼å¼é©—è­‰ï¼Œç›´æ¥ä½¿ç”¨
                document.getElementById('barcodeInput').value = qrData;
                updateStatus('âœ… QR Codeè®€å–æˆåŠŸï¼', 'success');
        
                if (uploadArea) {
                    const hintDiv = uploadArea.querySelector('.upload-content div:last-child');
                    if (hintDiv) {
                        hintDiv.textContent = 'âœ… å·²è®€å–æˆåŠŸ';
                        hintDiv.style.color = '#059669';
                    }
                }
            } else {
                updateStatus('âŒ ç„¡æ³•è­˜åˆ¥QR Code', 'error');
        
                if (uploadArea) {
                    const hintDiv = uploadArea.querySelector('.upload-content div:last-child');
                    if (hintDiv) {
                        hintDiv.textContent = 'âŒ ç„¡æ³•è­˜åˆ¥';
                        hintDiv.style.color = '#dc2626';
                    }
                }
            }
        }

        function isValidHRVQRData(data) {
            const requiredParams = ['SDNN', 'RMSSD', 'LF', 'HF', 'LFHF', 'pNN50'];
            return requiredParams.every(param => data.includes(param + '='));
        }

        // åœ¨é€™è£¡æ–°å¢ setupDragAndDrop å‡½æ•¸
        function setupDragAndDrop() {
            const uploadAreas = document.querySelectorAll('.upload-area');
    
            uploadAreas.forEach(area => {
                area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('dragover');
                });
        
                area.addEventListener('dragleave', () => {
                    area.classList.remove('dragover');
                });
        
                area.addEventListener('drop', (e) => {
                    e.preventDefault();
                    area.classList.remove('dragover');
            
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        if (file.type.startsWith('image/')) {
                            if (area.closest('#qrcode-input')) {
                                processQRCodeImage({ files: [file] });
                            }
                        }
                    }
                });
            });
        }

        function displayImagePreview(containerId, imageSrc, fileName) {
            // é€™å€‹å‡½æ•¸ç¾åœ¨ç”± processQRCodeImage ç›´æ¥è™•ç†
            // ä¿ç•™ç©ºå‡½æ•¸é¿å…éŒ¯èª¤
        }

        function simulateQRCodeReading(fileName) {
            // æ¨¡æ“¬ä¸åŒçš„QRç¢¼è­˜åˆ¥çµæœ - ä½¿ç”¨ä½ çš„æ–°æ ¼å¼
            const mockResults = [
                "RMSSD=41.7&pNN50=22&LF=685.4&HF=445.9&LFHF=1.8&SDNN=71.2",
                "SDNN=82.6&RMSSD=55.1&LF=590.8&HF=580.3&LFHF=1.0&pNN50=35",
                "RMSSD=33.8&pNN50=15&LF=950.2&HF=285.4&LFHF=3.3&SDNN=58.9",
                "SDNN=68.3&RMSSD=52.4&LF=615.2&HF=525.8&LFHF=1.2&pNN50=30"
            ];
    
            // æ ¹æ“šæª”åç‰¹æ€§æ±ºå®šæ˜¯å¦æˆåŠŸè­˜åˆ¥
            if (fileName.toLowerCase().includes('qr') || fileName.toLowerCase().includes('code')) {
                return mockResults[Math.floor(Math.random() * mockResults.length)];
            }
    
            // 20% æ©Ÿç‡æˆåŠŸè­˜åˆ¥ï¼ˆé™ä½éš¨æ„æˆåŠŸçš„æ©Ÿç‡ï¼‰
            return Math.random() > 0.8 ? mockResults[Math.floor(Math.random() * mockResults.length)] : null;
        }

        function updateStatus(message, type = '') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = type;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            if (tabName === 'settings') {
                updateSettingsUI();
            }
        }

        function loadDemo() {
            if (currentInputMethod === 'manual') {
                // æ‰‹å‹•è¼¸å…¥æ¨¡å¼ï¼šè¼‰å…¥åˆ°è¡¨å–®
                const demoData = {
                    'SDNN': 68.3,
                    'RMSSD': 52.4,
                    'LF': 615.2,
                    'HF': 525.8,
                    'LFHF': 1.2,
                    'pNN50': 30
                };
        
                Object.entries(demoData).forEach(([param, value]) => {
                    const input = document.getElementById(`input-${param}`);
                    if (input) {
                        input.value = value;
                    }
                });
            } else {
                // QR Codeæ¨¡å¼ï¼šè¼‰å…¥åˆ°æ–‡å­—æ¡†å’Œé¡¯ç¤ºç¤ºç¯„åœ–ç‰‡
                document.getElementById('barcodeInput').value = "RMSSD=52.4&pNN50=30&LF=615.2&HF=525.8&LFHF=1.2&SDNN=68.3";
        
                const uploadArea = document.querySelector('#qrcode-input .upload-area');
                if (uploadArea) {
                    uploadArea.innerHTML = `
                        <div class="upload-content">
                            <img src="./demo-qr.png" alt="ç¤ºç¯„QR Code" style="max-width: 200px; max-height: 150px; border-radius: 6px; margin-bottom: 10px;">
                            <div style="font-size: 0.9em; color: #6b7280; margin-bottom: 5px;">ç¤ºç¯„QR Code</div>
                            <div style="font-size: 0.8em; color: #059669;">âœ… å·²è¼‰å…¥ç¤ºç¯„æ•¸æ“šï¼Œé»æ“Šæ›´æ›</div>
                        </div>
                    `;
                }
            }

            document.getElementById('status').textContent = 'âœ… ç¤ºç¯„æ•¸æ“šå·²è¼‰å…¥';
            document.getElementById('status').className = 'success';
        }

        function clearAllData() {
            // æ¸…é™¤æ‰‹å‹•è¼¸å…¥è¡¨å–®
            const inputIds = ['SDNN', 'RMSSD', 'LF', 'HF', 'LFHF', 'pNN50'];
            inputIds.forEach(id => {
                const input = document.getElementById(`input-${id}`);
                if (input) {
                    input.value = '';
                }
            });

            // æ¸…é™¤QR Codeç›¸é—œ
            document.getElementById('barcodeInput').value = '';
            document.getElementById('qrcodePreview').innerHTML = '';
            document.getElementById('qrcodeFile').value = '';

            // ğŸ”¥ æ¸…ç©ºç‹€æ…‹æè¿°
            const existingStateDesc = document.getElementById('stateDescription');
            if (existingStateDesc) {
                existingStateDesc.remove();
            }

            // é‡ç½®upload-areaåˆ°åŸå§‹ç‹€æ…‹
            const uploadArea = document.querySelector('#qrcode-input .upload-area');
            if (uploadArea) {
                uploadArea.innerHTML = `
                    <div class="upload-content">
                        <div class="upload-icon">ğŸ“±</div>
                        <div>é»æ“Šä¸Šå‚³QR Codeåœ–ç‰‡</div>
                        <div class="upload-hint">æ”¯æ´ JPG, PNG, GIF æ ¼å¼</div>
                    </div>
                `;
            }

            // ğŸ”¥ éš±è—åˆ†æçµæœå€å¡Š
            document.getElementById('results').classList.remove('show');
    
            // ğŸ”¥ æ¸…ç©ºåˆ†æçµæœå…§å®¹
            document.getElementById('parameters').innerHTML = '';
            document.getElementById('analysisResult').innerHTML = '';
            document.getElementById('recommendationsList').innerHTML = '';
    
            // ğŸ”¥ éš±è—åœ–è¡¨ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            const chartContainer = document.getElementById('hrv-chart');
            if (chartContainer) {
                chartContainer.style.display = 'none';
            }
        }

        function clearInput() {
            // ç›´æ¥å‘¼å«çµ±ä¸€çš„æ¸…ç©ºå‡½å¼
            clearAllData();

            // é‡ç½®ç‹€æ…‹
            const statusMessages = {
                manual: 'âœï¸ æ‰‹å‹•è¼¸å…¥æ¨¡å¼',
                qrcode: 'ğŸ“± QR Codeæƒææ¨¡å¼ - è«‹ä¸Šå‚³åœ–ç‰‡'
            };

            updateStatus(statusMessages[currentInputMethod] || 'âœï¸ æ‰‹å‹•è¼¸å…¥æ¨¡å¼', '');
        }

        function isValidHRVData(inputValue) {
            if (!inputValue) return false;
            const requiredParams = ['RMSSD', 'pNN50', 'LF', 'HF', 'LFHF', 'SDNN'];
            return requiredParams.every(param => inputValue.includes(param + '='));
        }

        function parseData(dataString) {
            const params = {};
            
            if (dataString.includes('hrv?') || dataString.includes('&')) {
                let cleanUrl = dataString;
                const hrvIndex = dataString.indexOf('hrv?');
                if (hrvIndex !== -1) {
                    cleanUrl = dataString.substring(hrvIndex + 4);
                } else {
                    const questionIndex = dataString.indexOf('?');
                    if (questionIndex !== -1) {
                        cleanUrl = dataString.substring(questionIndex + 1);
                    }
                }
                
                const urlParams = new URLSearchParams(cleanUrl);
                for (const [key, value] of urlParams) {
                    const numValue = parseFloat(value);
                    if (!isNaN(numValue)) {
                        params[key] = numValue;
                    }
                }
            }
            
            return params;
        }

        function analyzeData() {
            let params = {};
    
            // æ ¹æ“šç•¶å‰è¼¸å…¥æ–¹å¼æ”¶é›†æ•¸æ“š
            if (currentInputMethod === 'manual') {
                // æ‰‹å‹•è¼¸å…¥æ¨¡å¼ï¼šå¾è¡¨å–®æ”¶é›†æ•¸æ“š
                params = collectFormData();
        
                if (Object.keys(params).length === 0) {
                    alert('è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹åƒæ•¸ï¼');
                    return;
                }
            } else {
                // QR Codeæ¨¡å¼ï¼šå¾åŸæœ‰çš„æ–‡å­—æ¡†è®€å–
                const inputValue = document.getElementById('barcodeInput').value.trim();
        
                if (!inputValue) {
                    alert('è«‹ä¸Šå‚³QR Codeåœ–ç‰‡æˆ–è¼¸å…¥æ•¸æ“šï¼');
                    return;
                }

                if (!isValidHRVData(inputValue)) {
                    alert('âŒ æ•¸æ“šæ ¼å¼éŒ¯èª¤ï¼');
                    return;
                }

                params = parseData(inputValue);
                const requiredParams = ['RMSSD', 'pNN50', 'LF', 'HF', 'LFHF', 'SDNN'];
                const missingParams = requiredParams.filter(param => !(param in params));
        
                if (missingParams.length > 0) {
                    alert(`âŒ ç¼ºå°‘åƒæ•¸ï¼š${missingParams.join(', ')}`);
                    return;
                }
            }

            try {
                displayParameters(params);
                const hrvGrading = performHRVGrading(params);
                displayAnalysis(hrvGrading);
        
                document.getElementById('results').classList.add('show');
                document.getElementById('status').textContent = 'âœ… åˆ†æå®Œæˆï¼';
                document.getElementById('status').className = 'success';
        
            } catch (error) {
                alert('âŒ æ•¸æ“šè™•ç†éŒ¯èª¤ï¼');
            }
        }

        function collectFormData() {
            const params = {};
            const inputIds = ['SDNN', 'RMSSD', 'LF', 'HF', 'LFHF', 'pNN50'];
    
            inputIds.forEach(id => {
                const input = document.getElementById(`input-${id}`);
                if (input && input.value.trim() !== '') {
                    params[id] = parseFloat(input.value);
                }   
            });
    
            return params;
        }

        function performHRVGrading(params) {
            if (!systemSettings.hrvGrading.enabled) return null;

            const rmssd = params.RMSSD || params.rMSSD;
            if (!rmssd) return null;

            // æ‰¾åˆ°æ‰€æœ‰ç¬¦åˆrMSSDæ¢ä»¶çš„ç´šåˆ¥
            const matchingGrades = [];

            Object.entries(systemSettings.hrvGrading.grades).forEach(([gradeId, grade]) => {
                let matches = false;

                if (gradeId === 'grade1') {
                    matches = rmssd > 75;
                } else if (gradeId === 'grade2') {
                    matches = rmssd > 45 && rmssd <= 75;
                } else if (gradeId === 'grade3') {
                    matches = rmssd > 25 && rmssd <= 45;
                } else if (gradeId === 'grade4') {
                    matches = rmssd > 19 && rmssd <= 30;
                } else if (gradeId === 'grade5') {
                    matches = rmssd > 12 && rmssd <= 19;
                } else if (gradeId === 'grade6') {
                    matches = rmssd <= 12;
                }

                if (matches) {
                    matchingGrades.push({ 
                        id: gradeId, 
                        ...grade, 
                        gradeIndex: parseInt(gradeId.replace('grade', ''))
                    });
                }
            });

            if (matchingGrades.length === 0) return null;

            // é¸æ“‡é¢¨éšªæœ€åš´é‡çš„ç´šåˆ¥ä½œç‚ºä¸»è¦ç´šåˆ¥ï¼ˆç´šåˆ¥æ•¸å­—è¶Šå¤§ = é¢¨éšªè¶Šé«˜ï¼‰
            matchingGrades.sort((a, b) => b.gradeIndex - a.gradeIndex);
            const primaryGrade = matchingGrades[0];
            const secondaryGrades = matchingGrades.slice(1);

            // ç”Ÿæˆè£œå……èªªæ˜
            const supplementaryInfo = generateSupplementaryInfo(params, primaryGrade);

            // ä¿å­˜è£œå……ç´šåˆ¥çš„å®Œæ•´ä¿¡æ¯
            const supplementaryGrades = [];
            const lfhfGrade = getLFHFGrade(params.LFHF);
            const pnn50Grade = getPNN50Grade(params.pNN50);

            if (lfhfGrade && lfhfGrade !== primaryGrade.gradeIndex) {
                const gradeKey = `grade${lfhfGrade}`;
                supplementaryGrades.push(systemSettings.hrvGrading.grades[gradeKey]);
            }

            if (pnn50Grade && pnn50Grade !== primaryGrade.gradeIndex && pnn50Grade !== lfhfGrade) {
                const gradeKey = `grade${pnn50Grade}`;
                supplementaryGrades.push(systemSettings.hrvGrading.grades[gradeKey]);
            }

            return {
                primary: primaryGrade,
                secondary: secondaryGrades,
                supplementary: supplementaryInfo,
                supplementaryGrades: supplementaryGrades,
                confidence: calculateGradingConfidence(params, primaryGrade),
                allMatches: matchingGrades
            };
        }

        function findParameterGrade(paramName, value) {
            const matchingGrades = [];
    
            Object.entries(systemSettings.hrvGrading.grades).forEach(([gradeId, grade]) => {
                const condition = grade.conditions[paramName];
                if (!condition) return;
        
                let matches = false;
        
                if (paramName === 'pNN50') {
                    // pNN50é‚Šç•Œåˆ¤æ–·é‚è¼¯ï¼ˆé¸æ“‡è¼ƒåš´é‡çš„ï¼‰
                    if (gradeId === 'grade1') {
                        matches = value > 30;
                    } else if (gradeId === 'grade2') {
                        matches = value > 15 && value <= 30;
                    } else if (gradeId === 'grade3') {
                        matches = value > 10 && value <= 20;
                    } else if (gradeId === 'grade4') {
                        matches = value > 6 && value <= 10;
                    } else if (gradeId === 'grade5') {
                        matches = value > 3 && value <= 6;
                    } else if (gradeId === 'grade6') {
                        matches = value <= 3;
                    }
                } else if (paramName === 'LFHF') {
                    // LFHFé‚Šç•Œåˆ¤æ–·é‚è¼¯ï¼ˆé¸æ“‡è¼ƒåš´é‡çš„ï¼‰
                    if (gradeId === 'grade1') {
                        matches = value > 0.3 && value <= 0.8;
                    } else if (gradeId === 'grade2') {
                        matches = value > 0.8 && value <= 2.0;
                    } else if (gradeId === 'grade3') {
                        matches = value > 1.5 && value <= 3.0;
                    } else if (gradeId === 'grade4') {
                        matches = value > 2.5 && value <= 4.0;
                    } else if (gradeId === 'grade5') {
                        matches = value > 3.5 && value <= 6.0;
                    } else if (gradeId === 'grade6') {
                        matches = value > 6.0 || value <= 0.3;
                    }
                } else {
                    // å…¶ä»–åƒæ•¸ä¿æŒåŸä¾†çš„é‚è¼¯
                    if (Array.isArray(condition)) {
                        for (const range of condition) {
                            if (value >= range.min && value <= range.max) {
                                matches = true;
                                break;
                            }
                        }
                    } else {
                        matches = value >= condition.min && value <= condition.max;
                    }
                }
        
                if (matches) {
                    matchingGrades.push({ id: gradeId, ...grade, gradeIndex: parseInt(gradeId.replace('grade', '')) });
                }
            });

            // pNN50å’ŒLFHFï¼šé¸æ“‡è¼ƒåš´é‡çš„ç´šåˆ¥ï¼ˆç´¢å¼•è¼ƒå¤§çš„ï¼‰
            if (matchingGrades.length > 0) {
                matchingGrades.sort((a, b) => b.gradeIndex - a.gradeIndex);
                return matchingGrades[0];
            }
    
            return null;
        }

        function calculateGradingConfidence(params, primaryGrade) {
            let matchingParams = 0;
            let totalParams = 0;
            
            Object.entries(primaryGrade.conditions).forEach(([param, condition]) => {
                if (params[param] !== undefined) {
                    totalParams++;
            
                    if (Array.isArray(condition)) {
                        for (const range of condition) {
                            if (params[param] >= range.min && params[param] <= range.max) {
                                matchingParams++;
                                break;
                            }
                        }
                    } else {
                        if (params[param] >= condition.min && params[param] <= condition.max) {
                            matchingParams++;
                        }
                    }
                }
            });
    
            return totalParams > 0 ? (matchingParams / totalParams) * 100 : 0;
        }

        // æ–°å¢ï¼šç”Ÿæˆè£œå……èªªæ˜çš„ä¸»è¦é‚è¼¯
        function generateSupplementaryInfo(params, primaryGrade) {
            const supplementaryInfo = [];
    
            // LFHF è£œå……åˆ¤æ–·
            if (params.LFHF !== undefined) {
                if (params.LFHF < 0.3) {
                    supplementaryInfo.push('è‡ªå¾‹ç¥ç¶“å¹³è¡¡åš´é‡å¤±èª¿ï¼Œå‰¯äº¤æ„Ÿç¥ç¶“éåº¦æ´»èº');
                } else if (params.LFHF > 6.0) {
                    supplementaryInfo.push('è‡ªå¾‹ç¥ç¶“å¹³è¡¡åš´é‡å¤±èª¿ï¼Œäº¤æ„Ÿç¥ç¶“éåº¦äº¢å¥®');
                } else if (params.LFHF > 3.5) {
                    supplementaryInfo.push('è‡ªå¾‹ç¥ç¶“åå‘äº¤æ„Ÿç¥ç¶“äº¢å¥®ç‹€æ…‹');
                } else if (params.LFHF > 2.5) {
                    supplementaryInfo.push('è‡ªå¾‹ç¥ç¶“å¹³è¡¡å‡ºç¾ä¸­åº¦åç§»');
                } else if (params.LFHF > 1.5) {
                    supplementaryInfo.push('è‡ªå¾‹ç¥ç¶“å¹³è¡¡å‡ºç¾è¼•åº¦åç§»');
                } else if (params.LFHF >= 0.3 && params.LFHF <= 0.8) {
                    supplementaryInfo.push('è‡ªå¾‹ç¥ç¶“å¹³è¡¡ç‹€æ…‹è‰¯å¥½');
                }
            }
    
            // pNN50 è£œå……åˆ¤æ–·
            if (params.pNN50 !== undefined) {
                if (params.pNN50 <= 3) {
                    supplementaryInfo.push('å¿ƒç‡è®Šç•°åº¦æ¥µä½ï¼Œèº«é«”æ¢å¾©èƒ½åŠ›åš´é‡ä¸è¶³');
                } else if (params.pNN50 <= 6) {
                    supplementaryInfo.push('å¿ƒç‡è®Šç•°åº¦åä½ï¼Œèº«é«”æ¢å¾©èƒ½åŠ›ä¸ä½³');
                } else if (params.pNN50 <= 10) {
                    supplementaryInfo.push('å¿ƒç‡è®Šç•°åº¦ç•¥ä½ï¼Œæ¢å¾©èƒ½åŠ›éœ€è¦æ”¹å–„');
                } else if (params.pNN50 <= 20) {
                    supplementaryInfo.push('å¿ƒç‡è®Šç•°åº¦ä¸­ç­‰ï¼Œèº«é«”é©æ‡‰åŠ›å°šå¯');
                } else if (params.pNN50 > 30) {
                    supplementaryInfo.push('å¿ƒç‡è®Šç•°åº¦è‰¯å¥½ï¼Œèº«é«”æ¢å¾©èƒ½åŠ›ä½³');
                }
            }  
    
            // ç¶œåˆåˆ¤æ–·
            const lfhfGrade = getLFHFGrade(params.LFHF);
            const pnn50Grade = getPNN50Grade(params.pNN50);
            const primaryGradeIndex = primaryGrade.gradeIndex;
    
            if ((lfhfGrade && lfhfGrade > primaryGradeIndex) || 
            (pnn50Grade && pnn50Grade > primaryGradeIndex)) {
                if (primaryGradeIndex >= 4) {
                    supplementaryInfo.push('å€‹åˆ¥æŒ‡æ¨™åæ˜ æ›´åš´é‡çš„èº«å¿ƒå£“åŠ›ç‹€æ³');
                } else {
                    supplementaryInfo.push('éƒ¨åˆ†æŒ‡æ¨™æç¤ºéœ€è¦æ³¨æ„å£“åŠ›ç®¡ç†');
                }
            }

            // ç•¶æœ‰æŒ‡æ¨™é¡¯ç¤ºè¼ƒå¥½ç‹€æ³æ™‚
            if ((lfhfGrade && lfhfGrade < primaryGradeIndex) || 
            (pnn50Grade && pnn50Grade < primaryGradeIndex)) {
                if (primaryGradeIndex >= 4) {
                    supplementaryInfo.push('éƒ¨åˆ†æŒ‡æ¨™é¡¯ç¤ºèº«é«”ä»ä¿æœ‰ä¸€å®šæ¢å¾©æ½›åŠ›');
                } else {
                    supplementaryInfo.push('éƒ¨åˆ†æŒ‡æ¨™åæ˜ è‰¯å¥½çš„èº«å¿ƒå¹³è¡¡ç‹€æ…‹');
                }
            }
    
            return supplementaryInfo;
        }

        // æ–°å¢ï¼šæ ¹æ“š LFHF å€¼åˆ¤æ–·å°æ‡‰ç´šåˆ¥
        function getLFHFGrade(lfhfValue) {
            if (lfhfValue === undefined) return null;
    
            if (lfhfValue > 0.3 && lfhfValue <= 0.8) return 1;
            if (lfhfValue > 0.8 && lfhfValue <= 2.0) return 2;
            if (lfhfValue > 1.5 && lfhfValue <= 3.0) return 3;
            if (lfhfValue > 2.5 && lfhfValue <= 4.0) return 4;
            if (lfhfValue > 3.5 && lfhfValue <= 6.0) return 5;
            if (lfhfValue > 6.0 || lfhfValue <= 0.3) return 6;
    
            return null;
        }

        // æ–°å¢ï¼šæ ¹æ“š pNN50 å€¼åˆ¤æ–·å°æ‡‰ç´šåˆ¥
        function getPNN50Grade(pnn50Value) {
            if (pnn50Value === undefined) return null;
    
            if (pnn50Value > 30) return 1;
            if (pnn50Value > 15 && pnn50Value <= 30) return 2;
            if (pnn50Value > 10 && pnn50Value <= 20) return 3;
            if (pnn50Value > 6 && pnn50Value <= 10) return 4;
            if (pnn50Value > 3 && pnn50Value <= 6) return 5;
            if (pnn50Value <= 3) return 6;
    
            return null;
        }
        
        function displayParameters(params) {
            const container = document.getElementById('parameters');
            container.innerHTML = '';
            
            const parameterOrder = ['SDNN', 'RMSSD', 'LF', 'HF', 'LFHF', 'pNN50'];
            
            parameterOrder.forEach(key => {
                if (params[key] !== undefined) {
                    const value = params[key];
                    let status = 'normal'; // é è¨­ç‚ºç¶ è‰²ï¼ˆç†æƒ³ç¯„åœï¼‰
        
                // æ ¹æ“šåœ–è¡¨è¨­å®šå„åƒæ•¸çš„åˆ†ç´šæ¨™æº–
                if (key === 'SDNN') {
                    if (value > 93) status = 'normal';      // ç¶ è‰²ï¼š>93ms
                    else if (value >= 32) status = 'warning'; // é»ƒè‰²ï¼š32-93ms
                    else status = 'danger';                 // ç´…è‰²ï¼š<32ms
                }
                else if (key === 'RMSSD') {
                    if (value > 75) status = 'normal';      // ç¶ è‰²ï¼š>75ms
                    else if (value >= 19) status = 'warning'; // é»ƒè‰²ï¼š19-75ms
                    else status = 'danger';                 // ç´…è‰²ï¼š<19ms
                }
                else if (key === 'LF') {
                    if (value > 900) status = 'normal';     // ç¶ è‰²ï¼š>900msÂ²
                    else if (value >= 193) status = 'warning'; // é»ƒè‰²ï¼š193-900msÂ²
                    else status = 'danger';                 // ç´…è‰²ï¼š<193msÂ²
                }
                else if (key === 'HF') {
                    if (value > 3630) status = 'normal';    // ç¶ è‰²ï¼š>3630msÂ²
                    else if (value >= 82) status = 'warning';  // é»ƒè‰²ï¼š82-3630msÂ²
                    else status = 'danger';                 // ç´…è‰²ï¼š<82msÂ²
                }
                else if (key === 'LFHF') {
                    if (value >= 0.5 && value <= 3.0) status = 'normal'; // ç¶ è‰²ï¼š0.5-3.0
                    else if (value > 3.0 && value <= 5.0) status = 'warning'; // é»ƒè‰²ï¼š3.0-5.0
                    else status = 'danger';                 // ç´…è‰²ï¼š>5.0 æˆ– <0.5
                }
                else if (key === 'pNN50') {
                    if (value > 50) status = 'normal';      // ç¶ è‰²ï¼š>50%
                    else if (value >= 6) status = 'warning';  // é»ƒè‰²ï¼š6-50%
                    else status = 'danger';                 // ç´…è‰²ï¼š<6%
                }
        
                const card = document.createElement('div');
                card.className = `param-card ${status}`;
                card.innerHTML = `
                    <h4>${key}</h4>
                    <div class="value">${Number.isInteger(value) ? value : value.toFixed(1)}</div>
                `;
        
                container.appendChild(card);
            }
            });
        }

        function displayAnalysis(hrvGrading = null) {
            const resultDiv = document.getElementById('analysisResult');
            const recommendationsDiv = document.getElementById('recommendationsList');

            if (hrvGrading && hrvGrading.primary) {
                resultDiv.innerHTML = `
                    <h3 style="color: ${hrvGrading.primary.color}; margin-bottom: 15px;">${hrvGrading.primary.name}</h3>
                    <p style="margin-bottom: 8px;"><strong>ä¸»è¦ä¾æ“šï¼š</strong>rMSSD å€¼åˆ¤æ–·</p>

                    <div class="chart-container-responsive" id="hrv-chart" style="display: none;">
                        <div class="quadrant-chart">
                            <div class="quadrant-background"></div>
                            <div class="x-axis-arrow"></div>
                            <div class="y-axis-arrow"></div>
                            <div class="axis-origin"></div>
                            <div class="y-axis-label">è‡ªå¾‹ç¥ç¶“å¹³è¡¡</div>
                            <div class="x-axis-label">å‰¯äº¤æ„Ÿç¥ç¶“æ´»æ€§</div>
                        </div>
                    </div>
                `;

                resultDiv.style.background = `${hrvGrading.primary.color}20`;
                resultDiv.style.borderLeft = `4px solid ${hrvGrading.primary.color}`;
            } else {
                resultDiv.innerHTML = `
                    <h3 style="color: #dc2626;">ç„¡æ³•é€²è¡ŒHRVåˆ†ç´š</h3>
                    <p>è«‹ç¢ºèªè¼¸å…¥çš„æ•¸æ“šæ˜¯å¦æ­£ç¢º</p>
                `;
                resultDiv.style.background = '#fef2f2';
                resultDiv.style.borderLeft = '4px solid #dc2626';
            }

            recommendationsDiv.innerHTML = '';
            const recommendations = getRecommendations(hrvGrading);
            recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recommendationsDiv.appendChild(li);
            });

            // ğŸ”¥ æ–°å¢ï¼šé¡¯ç¤ºç‹€æ…‹æè¿°
            displayStateDescription(hrvGrading);

            // ä¿®æ­£ï¼šæ ¹æ“šç•¶å‰è¼¸å…¥æ¨¡å¼æ”¶é›†æ­£ç¢ºçš„åƒæ•¸
            let params = {};
            if (currentInputMethod === 'manual') {
                params = collectFormData();
            } else {
                const inputValue = document.getElementById('barcodeInput').value.trim();
                if (inputValue) {
                    params = parseData(inputValue);
                }
            }

            updateHRVChart(params, hrvGrading);
        }

        function displayStateDescription(hrvGrading = null) {
            // æ¸…é™¤ç¾æœ‰çš„ç‹€æ…‹æè¿°
            const existingStateDesc = document.getElementById('stateDescription');
            if (existingStateDesc) {
                existingStateDesc.remove();
            }

            if (!hrvGrading || !hrvGrading.primary) return;

            const stateDescriptions = {
                grade1: [
                    'æ—©æ™¨é†’ä¾†å³å¯æ´»å‹•ï¼Œé«”åŠ›é£½æ»¿ï¼Œå¾ˆå°‘æ„Ÿåˆ°ç–²æ†Š',
                    'ä¸€æ•´å¤©éƒ½èƒ½ç¶­æŒç©©å®šçš„é«”èƒ½ï¼Œä¸æ˜“æ„Ÿåˆ°ç´¯',
                    'æƒ…ç·’å¹³å’Œã€æ¨‚è§€ï¼Œå¶æœ‰å£“åŠ›ä¹Ÿèƒ½è‡ªæˆ‘è½‰åŒ–ç‚ºå‹•åŠ›',
                    'èˆ‡äººäº’å‹•æ™‚ï¼Œèªæ°£å’Œç·©ï¼Œæ¨‚æ–¼åˆ†äº«èˆ‡å‚¾è½',
                    'æ€è€ƒæ¸…æ™°ï¼Œåæ‡‰æ•æ·ï¼Œå·¥ä½œæ™‚å°‘æœ‰åˆ†å¿ƒæƒ…æ³',
                    'æ±ºç­–æœæ–·ï¼Œèƒ½åŒæ™‚è™•ç†å¤šé …ä»»å‹™ä¸”ç¶­æŒå“è³ª',
                    'èº«é«”ç„¡æ˜é¡¯ç·Šç¹ƒæ„Ÿï¼Œè‚©é ¸ã€èƒŒéƒ¨æ”¾é¬†è‡ªç„¶',
                    'å…¥ç¡è¿…é€Ÿã€æ·±ç¡æœŸå®Œæ•´ï¼Œå¤œé–“æ¥µå°‘é†’ä¾†'
                ],
                grade2: [
                    'ä¸€èˆ¬æ´»å‹•ç„¡å›°é›£ï¼Œä½†é‡åˆ°é«˜å¼·åº¦å·¥ä½œæˆ–é‹å‹•å¾Œæ¢å¾©ç¨æ…¢',
                    'å¶çˆ¾æ„Ÿå—åƒæ˜¯ã€Œå°ä½æ½®ã€ï¼Œé¢å°çªç™¼ç‹€æ³æ™‚å¿ƒè·³æœƒåŠ å¿«ï¼Œéœ€è¦çŸ­æš«ä¼‘æ¯',
                    'å¤§å¤šæ™‚å€™å¿ƒæ…‹ç©©å®šï¼Œä½†å£“åŠ›ç´¯ç©åˆ°ä¸€å®šç¨‹åº¦æœƒå‡ºç¾ç„¦èº',
                    'å®¹æ˜“å› å°äº‹æ‰“äº‚æƒ…ç·’ï¼Œéœ€è¦æœ‰æ„è­˜åœ°æ”¾é¬†',
                    'å¹³æ™‚å°ˆæ³¨åŠ›è‰¯å¥½ï¼Œä½†é•·æ™‚é–“å·¥ä½œå¾Œå®¹æ˜“èµ°ç¥æˆ–å‡ºéŒ¯',
                    'å­¸ç¿’æ–°äº‹ç‰©æˆ–è§£æ±ºè¤‡é›œå•é¡Œæ™‚ï¼Œç²¾åŠ›ç¶­æŒç´„ 1~2 å°æ™‚',
                    'è¦ºå¾—è‚©è†€æˆ–ä¸‹èƒŒè‚Œè‚‰ç•¥å¾®ç·Šç¹ƒï¼Œä½†ä¸æœƒé•·æ™‚é–“ç–¼ç—›',
                    'å…¥ç¡ç´„ 15~20 åˆ†é˜ï¼Œå¶çˆ¾å¤œé–“é†’ä¾†ä¸€æ¬¡',
                    'ç¡é†’å¾Œéœ€ 10~20 åˆ†é˜æ‰èƒ½å®Œå…¨æ¸…é†’'
                ],
                grade3: [
                    'æ—©ä¸Šé†’ä¾†æœ‰æ²‰é‡æ„Ÿï¼Œå‰åŠå¤©ç²¾ç¥ä¸è¶³',
                    'å®¹æ˜“åœ¨ä¸‹åˆå‡ºç¾ã€Œèƒ½é‡å´©ç›¤ã€éœ€è¦è£œçœ æˆ–å’–å•¡å› ',
                    'æƒ…ç·’æ³¢å‹•é–‹å§‹æ˜é¡¯ï¼Œå°äº‹æ™‚å¸¸è¦ºå¾—ç„¦èºæˆ–ç…©æ‚¶',
                    'èˆ‡äººæºé€šæ™‚å¶æœ‰è€å¿ƒä¸è¶³çš„æƒ…æ³',
                    'æ³¨æ„åŠ›ä¸é›†ä¸­ï¼Œè¨˜æ†¶åŠ›ç•¥æœ‰ä¸‹é™ï¼Œå®¹æ˜“å¿˜è¨˜å‰›å‰›æ‰åšéçš„äº‹',
                    'æ„Ÿåˆ°è‚©é ¸é…¸ç—›æˆ–é ­éƒ¨å£“åŠ›æ„Ÿ',
                    'çŸ­æš«ä¼‘æ¯å¾Œä»éœ€è¼ƒé•·æ™‚é–“æ‰èƒ½çœŸæ­£èˆ’ç·©',
                    'å…¥ç¡éœ€ 20~30 åˆ†é˜ï¼Œæ·±ç¡æœŸæ¸›å°‘',
                    'å¤œé–“æ˜“è¢«å…‰æˆ–è²éŸ³åµé†’ï¼Œé†’å¾Œä»æœ‰ç–²å€¦æ„Ÿ'
                ],
                grade4: [
                    'å¸¸è¦ºå¾—åŠ›ä¸å¾å¿ƒï¼Œé€£æ—¥å¸¸èµ°å‹•ä¹Ÿæ˜“æ„ŸåƒåŠ›',
                    'é ¸ã€è‚©ã€è…°ç¶“å¸¸ç— ç—›',
                    'å…§å¿ƒæŒçºŒç·Šç¹ƒã€æ˜“ç·Šå¼µï¼Œæˆ–å‡ºç¾ç„¡åç…©èº',
                    'æ€è·¯ç·©æ…¢ï¼Œæ±ºç­–æ‹–å»¶ï¼Œå®¹æ˜“å› å£“åŠ›é€ƒé¿å•é¡Œ',
                    'å·¥ä½œæ•ˆç‡æ˜é¡¯ä¸‹é™ï¼Œéœ€è¦æ›´å¤šæ™‚é–“å®Œæˆä»»å‹™',
                    'æ‰‹å¿ƒå‡ºæ±—ã€å‘¼å¸æ€¥ä¿ƒ',
                    'å…¥ç¡æ™‚é–“è¶…é 30 åˆ†é˜ï¼Œæ˜“åè¦†ç¿»é†’',
                    'å¤œé–“é†’ä¾† 2~3 æ¬¡ï¼Œä¸”é›£ä»¥å¿«é€Ÿå†ç¡'
                ],
                grade5: [
                    'é•·æœŸç–²æ†Šï¼Œæ—¥å¸¸æ´»å‹•åŠ›ä¸å¾å¿ƒï¼Œé«”åŠ›æŒçºŒé€æ”¯',
                    'æ˜“æ„Ÿå†’æˆ–å…¶ä»–å°æ¯›ç—…çºèº«',
                    'æŒçºŒç„¦æ…®æˆ–æƒ…ç·’ä½è½ï¼Œæ˜“æ„Ÿç„¡åŠ©æˆ–æ²®å–ª',
                    'æ„Ÿåˆ°æ‚²è§€ï¼Œç¤¾äº¤æ„é¡˜æ˜é¡¯ä¸‹é™',
                    'å¤šæ•¸æ™‚é–“è™•æ–¼ã€Œæ©Ÿæ¢°å¼ã€å®Œæˆä»»å‹™ç‹€æ…‹ï¼Œå‰µé€ åŠ›å¹¾ä¹åœæ»¯',
                    'è‡ªæˆ‘èª¿é©æ–¹æ³•å¤šæ•¸ç„¡æ•ˆï¼Œç”šè‡³åŠ é‡ç„¦æ…®',
                    'åš´é‡å¤±çœ ï¼Œå…¥ç¡å¸¸éœ€ 1 å°æ™‚ä»¥ä¸Šï¼Œç¡çœ æ–·è£‚',
                    'ç¡çœ æ™‚é–“ä¸è¶³ 6 å°æ™‚ï¼Œä¸”ç¡é†’å¾Œä»æ¥µåº¦ç–²æ†Š'
                ],
                grade6: [
                    'æ¥µåº¦è™›å¼±ï¼Œæ—¥å¸¸èµ°å‹•æˆ–ç°¡å–®å®¶å‹™éƒ½æ„Ÿåˆ°åƒåŠ›',
                    'é•·æœŸå…ç–«åŠŸèƒ½ç´Šäº‚ï¼Œæ…¢æ€§ç™¼ç‚æˆ–æ„Ÿå†’é »ç¹',
                    'æŒçºŒä½è½ã€å°äº‹ç‰©å–ªå¤±èˆˆè¶£ï¼Œå¯èƒ½ä¼´æœ‰ç„¡åŠ©æˆ–çµ•æœ›æ„Ÿ',
                    'å¹¾ä¹ç„¡æ³•é›†ä¸­æ³¨æ„ï¼Œæ€è€ƒåœæ»¯ï¼Œé›£ä»¥çµ„ç¹”åŸºæœ¬èªå¥',
                    'è¨˜æ†¶åŠ›åš´é‡ä¸‹é™ï¼ŒçŸ­æœŸèˆ‡é•·æœŸè¨˜æ†¶éƒ½æœ‰å•é¡Œ',
                    'ç„¡æ³•å…¥ç¡æˆ–åƒ…ç¡ä¸åˆ° 3 å°æ™‚',
                    'å³ä½¿ç¡è‘—ï¼Œä»ç„¡æ³•ç·©è§£èº«å¿ƒç–²å‹'
                ]
            };

            const gradeKey = `grade${hrvGrading.primary.gradeIndex}`;
            let descriptions = [...stateDescriptions[gradeKey]] || [];

            // æ ¹æ“šè£œå……èªªæ˜æ·»åŠ ç‰¹å®šç—‡ç‹€
            let supplementaryDescriptions = [];
            if (hrvGrading.supplementary && hrvGrading.supplementary.length > 0) {
                hrvGrading.supplementary.forEach(info => {
                    if (info.includes('LFHF') && info.includes('å£“åŠ›')) {
                        if (!descriptions.some(desc => desc.includes('ç·Šå¼µ') || desc.includes('å¿ƒè·³'))) {
                            supplementaryDescriptions.push('è‡ªå¾‹ç¥ç¶“å¹³è¡¡åå‘å£“åŠ›åæ‡‰ï¼Œæ˜“æœ‰ç·Šå¼µæ„Ÿ');
                        }
                    }
                    if (info.includes('pNN50') && info.includes('ç–²å‹')) {
                        if (!descriptions.some(desc => desc.includes('æ¢å¾©'))) {
                            supplementaryDescriptions.push('å¿ƒç‡è®Šç•°åº¦é™ä½ï¼Œèº«é«”æ¢å¾©èƒ½åŠ›éœ€è¦é—œæ³¨');
                        }
                    }
                });
            }

            // æº–å‚™è£œå……èªªæ˜çš„ HTML
            let supplementaryHTML = '';
            if (hrvGrading.supplementary && hrvGrading.supplementary.length > 0) {
                supplementaryHTML = `
                    <div style="margin-top: 15px; padding: 15px; background: #eff6ff; border-radius: 6px; border: 1px solid #4c85b5;">
                        <div style="font-size: 0.9em; color: #494949; line-height: 1.5; font-weight: 500;">
                            <strong>è£œå……èªªæ˜ï¼š</strong>${hrvGrading.supplementary.join('ã€')}
                        </div>
                    </div>
                `;
            }
            
            // å‰µå»ºç‹€æ…‹æè¿°å€å¡Š
            const stateDescDiv = document.createElement('div');
            stateDescDiv.id = 'stateDescription';
            stateDescDiv.className = 'recommendations';

            // åˆ†åˆ¥å‰µå»ºå„å€‹éƒ¨åˆ†
            const mainDescriptions = descriptions.concat(supplementaryDescriptions);
            const listHTML = mainDescriptions.map(desc => `<li>${desc}</li>`).join('');

            stateDescDiv.innerHTML = `
                <h4>ğŸ“‹ ç‹€æ…‹æè¿°</h4>
                <ul>
                    ${listHTML}
                </ul>
                ${supplementaryHTML}
            `;

            // æ’å…¥åˆ°ã€Œå€‹äººåŒ–å»ºè­°ã€å‰é¢
            const recommendationsDiv = document.querySelector('.recommendations');
            recommendationsDiv.parentNode.insertBefore(stateDescDiv, recommendationsDiv);
        }

        function getRecommendations(hrvGrading = null) {
            const recommendations = [];

            // æ·»åŠ ä¸»è¦ç´šåˆ¥çš„å»ºè­°
            if (hrvGrading && hrvGrading.primary && hrvGrading.primary.recommendations) {
                hrvGrading.primary.recommendations.forEach(rec => {
                    if (rec.trim()) recommendations.push(rec);
                });
            }

            // æ ¹æ“šè£œå……èªªæ˜æ·»åŠ ç›¸é—œç´šåˆ¥çš„å»ºè­°
            if (hrvGrading && hrvGrading.supplementaryGrades) {
                hrvGrading.supplementaryGrades.forEach(grade => {
                    grade.recommendations.forEach(rec => {
                        // é¿å…é‡è¤‡æ·»åŠ ç›¸åŒå»ºè­°
                        if (rec.trim() && !recommendations.includes(rec)) {
                        recommendations.push(rec);
                        }
                    });
                });
            }

            // æœ€å¾Œå›ºå®šæ·»åŠ å°ˆæ¥­é†«ç™‚å»ºè­°
            recommendations.push('å»ºè­°è«®è©¢å°ˆæ¥­é†«ç™‚äººå“¡');
            return recommendations;
        }

        function updateSettingsUI() {
            updateParameterRangesUI();
            updateHRVGradingUI();
        }

        function updateHRVGradingUI() {
            const classificationContainer = document.getElementById('classificationList');

            // æ¸…ç©ºåŸæœ‰çš„åˆ†é¡åˆ—è¡¨å…§å®¹
            classificationContainer.innerHTML = '';

            // å‰µå»ºHRVåˆ†ç´šè¨­å®šä¾†å–ä»£åŸæœ‰çš„åˆ†é¡åˆ—è¡¨
            const hrvGradingSection = document.createElement('div');
            hrvGradingSection.className = 'hrv-grading-section';
            hrvGradingSection.innerHTML = `
                <div id="hrvGradesList"></div>
            `;

            // å°‡HRVåˆ†ç´šè¨­å®šæ”¾å…¥åˆ†é¡å®¹å™¨ä¸­
            classificationContainer.appendChild(hrvGradingSection);

            // æ›´æ–°åˆ†ç´šåˆ—è¡¨
            updateHRVGradesList();
        }

        function updateHRVGradesList() {
            const container = document.getElementById('hrvGradesList');
            console.log('Container found:', container); // ğŸ”¥ åŠ å…¥é€™è¡Œé™¤éŒ¯
            if (!container) return;

            container.innerHTML = '';

            // å®šç¾©ç‹€æ…‹æè¿°å…§å®¹
            const stateDescriptions = {
                grade1: [
                    'æ—©æ™¨é†’ä¾†å³å¯æ´»å‹•ï¼Œé«”åŠ›é£½æ»¿ï¼Œå¾ˆå°‘æ„Ÿåˆ°ç–²æ†Š',
                    'ä¸€æ•´å¤©éƒ½èƒ½ç¶­æŒç©©å®šçš„é«”èƒ½ï¼Œä¸æ˜“æ„Ÿåˆ°ç´¯',
                    'æƒ…ç·’å¹³å’Œã€æ¨‚è§€ï¼Œå¶æœ‰å£“åŠ›ä¹Ÿèƒ½è‡ªæˆ‘è½‰åŒ–ç‚ºå‹•åŠ›',
                    'èˆ‡äººäº’å‹•æ™‚ï¼Œèªæ°£å’Œç·©ï¼Œæ¨‚æ–¼åˆ†äº«èˆ‡å‚¾è½',
                    'æ€è€ƒæ¸…æ™°ï¼Œåæ‡‰æ•æ·ï¼Œå·¥ä½œæ™‚å°‘æœ‰åˆ†å¿ƒæƒ…æ³',
                    'æ±ºç­–æœæ–·ï¼Œèƒ½åŒæ™‚è™•ç†å¤šé …ä»»å‹™ä¸”ç¶­æŒå“è³ª',
                    'èº«é«”ç„¡æ˜é¡¯ç·Šç¹ƒæ„Ÿï¼Œè‚©é ¸ã€èƒŒéƒ¨æ”¾é¬†è‡ªç„¶',
                    'å…¥ç¡è¿…é€Ÿã€æ·±ç¡æœŸå®Œæ•´ï¼Œå¤œé–“æ¥µå°‘é†’ä¾†'
                ],
                grade2: [
                    'ä¸€èˆ¬æ´»å‹•ç„¡å›°é›£ï¼Œä½†é‡åˆ°é«˜å¼·åº¦å·¥ä½œæˆ–é‹å‹•å¾Œæ¢å¾©ç¨æ…¢',
                    'å¶çˆ¾æ„Ÿå—åƒæ˜¯ã€Œå°ä½æ½®ã€ï¼Œé¢å°çªç™¼ç‹€æ³æ™‚å¿ƒè·³æœƒåŠ å¿«ï¼Œéœ€è¦çŸ­æš«ä¼‘æ¯',
                    'å¤§å¤šæ™‚å€™å¿ƒæ…‹ç©©å®šï¼Œä½†å£“åŠ›ç´¯ç©åˆ°ä¸€å®šç¨‹åº¦æœƒå‡ºç¾ç„¦èº',
                    'å®¹æ˜“å› å°äº‹æ‰“äº‚æƒ…ç·’ï¼Œéœ€è¦æœ‰æ„è­˜åœ°æ”¾é¬†',
                    'å¹³æ™‚å°ˆæ³¨åŠ›è‰¯å¥½ï¼Œä½†é•·æ™‚é–“å·¥ä½œå¾Œå®¹æ˜“èµ°ç¥æˆ–å‡ºéŒ¯',
                    'å­¸ç¿’æ–°äº‹ç‰©æˆ–è§£æ±ºè¤‡é›œå•é¡Œæ™‚ï¼Œç²¾åŠ›ç¶­æŒç´„ 1~2 å°æ™‚',
                    'è¦ºå¾—è‚©è†€æˆ–ä¸‹èƒŒè‚Œè‚‰ç•¥å¾®ç·Šç¹ƒï¼Œä½†ä¸æœƒé•·æ™‚é–“ç–¼ç—›',
                    'å…¥ç¡ç´„ 15~20 åˆ†é˜ï¼Œå¶çˆ¾å¤œé–“é†’ä¾†ä¸€æ¬¡',
                    'ç¡é†’å¾Œéœ€ 10~20 åˆ†é˜æ‰èƒ½å®Œå…¨æ¸…é†’'
                ],
                grade3: [
                    'æ—©ä¸Šé†’ä¾†æœ‰æ²‰é‡æ„Ÿï¼Œå‰åŠå¤©ç²¾ç¥ä¸è¶³',
                    'å®¹æ˜“åœ¨ä¸‹åˆå‡ºç¾ã€Œèƒ½é‡å´©ç›¤ã€éœ€è¦è£œçœ æˆ–å’–å•¡å› ',
                    'æƒ…ç·’æ³¢å‹•é–‹å§‹æ˜é¡¯ï¼Œå°äº‹æ™‚å¸¸è¦ºå¾—ç„¦èºæˆ–ç…©æ‚¶',
                    'èˆ‡äººæºé€šæ™‚å¶æœ‰è€å¿ƒä¸è¶³çš„æƒ…æ³',
                    'æ³¨æ„åŠ›ä¸é›†ä¸­ï¼Œè¨˜æ†¶åŠ›ç•¥æœ‰ä¸‹é™ï¼Œå®¹æ˜“å¿˜è¨˜å‰›å‰›æ‰åšéçš„äº‹',
                    'æ„Ÿåˆ°è‚©é ¸é…¸ç—›æˆ–é ­éƒ¨å£“åŠ›æ„Ÿ',
                    'çŸ­æš«ä¼‘æ¯å¾Œä»éœ€è¼ƒé•·æ™‚é–“æ‰èƒ½çœŸæ­£èˆ’ç·©',
                    'å…¥ç¡éœ€ 20~30 åˆ†é˜ï¼Œæ·±ç¡æœŸæ¸›å°‘',
                    'å¤œé–“æ˜“è¢«å…‰æˆ–è²éŸ³åµé†’ï¼Œé†’å¾Œä»æœ‰ç–²å€¦æ„Ÿ'
                ],
                grade4: [
                    'å¸¸è¦ºå¾—åŠ›ä¸å¾å¿ƒï¼Œé€£æ—¥å¸¸èµ°å‹•ä¹Ÿæ˜“æ„ŸåƒåŠ›',
                    'é ¸ã€è‚©ã€è…°ç¶“å¸¸ç— ç—›',
                    'å…§å¿ƒæŒçºŒç·Šç¹ƒã€æ˜“ç·Šå¼µï¼Œæˆ–å‡ºç¾ç„¡åç…©èº',
                    'æ€è·¯ç·©æ…¢ï¼Œæ±ºç­–æ‹–å»¶ï¼Œå®¹æ˜“å› å£“åŠ›é€ƒé¿å•é¡Œ',
                    'å·¥ä½œæ•ˆç‡æ˜é¡¯ä¸‹é™ï¼Œéœ€è¦æ›´å¤šæ™‚é–“å®Œæˆä»»å‹™',
                    'æ‰‹å¿ƒå‡ºæ±—ã€å‘¼å¸æ€¥ä¿ƒ',
                    'å…¥ç¡æ™‚é–“è¶…é 30 åˆ†é˜ï¼Œæ˜“åè¦†ç¿»é†’',
                    'å¤œé–“é†’ä¾† 2~3 æ¬¡ï¼Œä¸”é›£ä»¥å¿«é€Ÿå†ç¡'
                ],
                grade5: [
                    'é•·æœŸç–²æ†Šï¼Œæ—¥å¸¸æ´»å‹•åŠ›ä¸å¾å¿ƒï¼Œé«”åŠ›æŒçºŒé€æ”¯',
                    'æ˜“æ„Ÿå†’æˆ–å…¶ä»–å°æ¯›ç—…çºèº«',
                    'æŒçºŒç„¦æ…®æˆ–æƒ…ç·’ä½è½ï¼Œæ˜“æ„Ÿç„¡åŠ©æˆ–æ²®å–ª',
                    'æ„Ÿåˆ°æ‚²è§€ï¼Œç¤¾äº¤æ„é¡˜æ˜é¡¯ä¸‹é™',
                    'å¤šæ•¸æ™‚é–“è™•æ–¼ã€Œæ©Ÿæ¢°å¼ã€å®Œæˆä»»å‹™ç‹€æ…‹ï¼Œå‰µé€ åŠ›å¹¾ä¹åœæ»¯',
                    'è‡ªæˆ‘èª¿é©æ–¹æ³•å¤šæ•¸ç„¡æ•ˆï¼Œç”šè‡³åŠ é‡ç„¦æ…®',
                    'åš´é‡å¤±çœ ï¼Œå…¥ç¡å¸¸éœ€ 1 å°æ™‚ä»¥ä¸Šï¼Œç¡çœ æ–·è£‚',
                    'ç¡çœ æ™‚é–“ä¸è¶³ 6 å°æ™‚ï¼Œä¸”ç¡é†’å¾Œä»æ¥µåº¦ç–²æ†Š'
                ],
                grade6: [
                    'æ¥µåº¦è™›å¼±ï¼Œæ—¥å¸¸èµ°å‹•æˆ–ç°¡å–®å®¶å‹™éƒ½æ„Ÿåˆ°åƒåŠ›',
                    'é•·æœŸå…ç–«åŠŸèƒ½ç´Šäº‚ï¼Œæ…¢æ€§ç™¼ç‚æˆ–æ„Ÿå†’é »ç¹',
                    'æŒçºŒä½è½ã€å°äº‹ç‰©å–ªå¤±èˆˆè¶£ï¼Œå¯èƒ½ä¼´æœ‰ç„¡åŠ©æˆ–çµ•æœ›æ„Ÿ',
                    'å¹¾ä¹ç„¡æ³•é›†ä¸­æ³¨æ„ï¼Œæ€è€ƒåœæ»¯ï¼Œé›£ä»¥çµ„ç¹”åŸºæœ¬èªå¥',
                    'è¨˜æ†¶åŠ›åš´é‡ä¸‹é™ï¼ŒçŸ­æœŸèˆ‡é•·æœŸè¨˜æ†¶éƒ½æœ‰å•é¡Œ',
                    'ç„¡æ³•å…¥ç¡æˆ–åƒ…ç¡ä¸åˆ° 3 å°æ™‚',
                    'å³ä½¿ç¡è‘—ï¼Œä»ç„¡æ³•ç·©è§£èº«å¿ƒç–²å‹'
                ]
            };

            Object.entries(systemSettings.hrvGrading.grades).forEach(([gradeId, grade], index) => {
                const gradeItem = document.createElement('div');
                gradeItem.className = 'classification-item hrv-grade-item';
                gradeItem.style.borderLeftColor = grade.color;

                gradeItem.innerHTML = `
                    <div class="classification-header">
                        <div><strong>ç´šåˆ¥ ${index + 1}</strong></div>
                    </div>

                    <div class="form-group">
                        <label>ç´šåˆ¥åç¨±ï¼š</label>
                        <input type="text" class="form-input" value="${grade.name}" readonly>
                    </div>
            
                    <div class="form-group">
                        <label>rMSSD åˆ¤æ–·ç¯„åœ (ä¸»è¦ä¾æ“š)ï¼š</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" class="form-input" value="${grade.rmssdRange.min}" 
                                onchange="updateHRVGradeRange('${gradeId}', 'min', this.value)" style="flex: 1;">
                            <span>-</span>
                            <input type="number" class="form-input" value="${grade.rmssdRange.max === Infinity ? '' : grade.rmssdRange.max}" 
                                placeholder="ç„¡ä¸Šé™" onchange="updateHRVGradeRange('${gradeId}', 'max', this.value)" style="flex: 1;">
                            <span>ms</span>
                        </div>
                        <div style="font-size: 0.8em; color: #6b7280; margin-top: 5px;">
                            æ³¨æ„ï¼šç¯„åœåˆ¤æ–·ç‚º ${gradeId === 'grade1' ? '>æœ€å°å€¼' : gradeId === 'grade6' ? 'â‰¤æœ€å¤§å€¼' : 'æœ€å°å€¼ < å€¼ â‰¤ æœ€å¤§å€¼'}
                        </div>
                    </div>

                    <div class="form-group">
                        <label>å…¶ä»–åƒæ•¸ç¯„åœ (è£œå……åˆ¤æ–·)ï¼š</label>
                        <div class="parameter-ranges">
                            ${Object.entries(grade.conditions).map(([param, range]) => {
                                if (param === 'LFHF' && Array.isArray(range)) {
                                return `
                                    <div class="param-range">
                                        <strong>${param}:</strong> 
                                        ${range.map(r => `${r.min === 0 ? '<' : ''}${r.min === Infinity ? '>' : r.min}${r.max === Infinity ? '+' : '-' + r.max}`).join(' æˆ– ')}
                                    </div>
                                `;
                                } else {
                                    return `
                                        <div class="param-range">
                                            <strong>${param}:</strong> ${range.min}${range.max === Infinity ? '+' : '-' + range.max}
                                        </div>
                                    `;
                                }
                            }).join('')}
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ç‹€æ…‹æè¿°ï¼š</label>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                                ${stateDescriptions[gradeId].map(desc => `<li style="margin-bottom: 8px; color: #374151;">${desc}</li>`).join('')}
                            </ol>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>å»ºè­°äº‹é …ï¼š</label>
                        <div class="suggestions-list">
                            ${grade.recommendations.map((rec, recIndex) => `
                                <div class="suggestion-item">
                                    <input type="text" class="suggestion-input" value="${rec}" 
                                        onchange="updateHRVGradeRecommendation('${gradeId}', ${recIndex}, this.value)">
                                    <button class="remove-btn" onclick="removeHRVGradeRecommendation('${gradeId}', ${recIndex})">ç§»é™¤</button>
                                </div>
                            `).join('')}
                        </div>
                        <button class="add-btn" onclick="addHRVGradeRecommendation('${gradeId}')">+ æ–°å¢å»ºè­°</button>
                    </div>
                `;

                container.appendChild(gradeItem);
            });
        }

        function updateHRVGradeRange(gradeId, type, value) {
            const grade = systemSettings.hrvGrading.grades[gradeId];
            if (grade) {
                if (type === 'min') {
                    grade.rmssdRange.min = parseFloat(value) || 0;
                } else {
                    grade.rmssdRange.max = value === '' ? Infinity : parseFloat(value);
                }
            }
        }

        function updateHRVGradeRecommendation(gradeId, index, value) {
            const grade = systemSettings.hrvGrading.grades[gradeId];
            if (grade && grade.recommendations[index] !== undefined) {
                grade.recommendations[index] = value;
            }
        }

        function addHRVGradeRecommendation(gradeId) {
            const grade = systemSettings.hrvGrading.grades[gradeId];
            if (grade) {
                grade.recommendations.push('');
                updateHRVGradesList();
            }
        }

        function removeHRVGradeRecommendation(gradeId, index) {
            const grade = systemSettings.hrvGrading.grades[gradeId];
            if (grade && index >= 0) {
                grade.recommendations.splice(index, 1);
                updateHRVGradesList();
            }
        }

        function updateParameterRangesUI() {
    const container = document.getElementById('parameterRanges');
    container.innerHTML = '';
    
    Object.entries(systemSettings.parameterRanges).forEach(([param, range]) => {
        const div = document.createElement('div');
        div.className = 'range-input-group';
        div.dataset.param = param;
        
        // æª¢æŸ¥æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ
        const isMobile = window.innerWidth <= 768;
        
        if (isMobile) {
            div.innerHTML = `
                <div class="param-title">${param}</div>
                <div class="value-inputs">
                    <div class="input-group">
                        <div class="input-label">æœ€å°å€¼</div>
                        <input type="number" class="range-input" value="${range.min}">
                    </div>
                    <div class="input-group">
                        <div class="input-label">æœ€å¤§å€¼</div>
                        <input type="number" class="range-input" value="${range.max}">
                    </div>
                </div>
                <div class="description-input">
                    <div class="input-label">èªªæ˜</div>
                    <input type="text" class="range-input" value="${range.description}">
                </div>
            `;
        } else {
            // æ¡Œé¢ç‰ˆä¿æŒåŸä¾†çš„æ ¼å¼
            div.innerHTML = `
                <label>${param}</label>
                <input type="number" class="range-input" value="${range.min}">
                <input type="number" class="range-input" value="${range.max}">
                <input type="text" class="range-input" value="${range.description}">
            `;
        }
        
        container.appendChild(div);
    });
}

function loadSettings() {
    try {
        const savedSettings = localStorage.getItem('hrvSystemSettings');
        if (savedSettings) {
            const parsedSettings = JSON.parse(savedSettings);
            
            // åˆä½µè¨­å®šï¼Œä¿ç•™é è¨­å€¼ä½œç‚ºå‚™ä»½
            if (parsedSettings.parameterRanges) {
                systemSettings.parameterRanges = {
                    ...systemSettings.parameterRanges,
                    ...parsedSettings.parameterRanges
                };
            }
            
            console.log('è¨­å®šå·²è¼‰å…¥');
        }
    } catch (error) {
        console.error('è¼‰å…¥è¨­å®šå¤±æ•—ï¼š', error);
        // å¦‚æœè¼‰å…¥å¤±æ•—ï¼Œä¿æŒä½¿ç”¨é è¨­è¨­å®š
    }
}

        function saveSettings() {
            const paramRanges = {};
            const rangeGroups = document.querySelectorAll('.range-input-group[data-param]');
            
            rangeGroups.forEach(elem => {
                const param = elem.dataset.param;
                const inputs = elem.querySelectorAll('input');
                
                paramRanges[param] = {
                    min: parseFloat(inputs[0].value) || 0,
                    max: parseFloat(inputs[1].value) || 100,
                    description: inputs[2].value || ''
                };
            });
            systemSettings.parameterRanges = paramRanges;

                try {
        localStorage.setItem('hrvSystemSettings', JSON.stringify(systemSettings));
        alert('è¨­å®šå·²å„²å­˜ï¼');
    } catch (error) {
        console.error('å„²å­˜è¨­å®šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š', error);
        alert('å„²å­˜å¤±æ•—ï¼š' + error.message);
    }
}

        function resetToDefault() {
            if (confirm('ç¢ºå®šè¦æ¢å¾©é è¨­è¨­å®šå—ï¼Ÿ')) {
                systemSettings.parameterRanges = {
                    'RMSSD': { min: 30, max: 100, description: 'é€£çºŒå¿ƒè·³é–“éš”å·®ç•°' },
                    'pNN50': { min: 10, max: 50, description: 'å¿ƒè·³è®Šç•°ç¨‹åº¦' },
                    'LF': { min: 300, max: 1500, description: 'ä½é »åŠŸç‡' },
                    'HF': { min: 300, max: 1000, description: 'é«˜é »åŠŸç‡' },
                    'LFHF': { min: 0.5, max: 2.5, description: 'è‡ªå¾‹ç¥ç¶“å¹³è¡¡' },
                    'SDNN': { min: 50, max: 150, description: 'å¿ƒè·³è®Šç•°æ¨™æº–å·®' }
                };
                
                updateSettingsUI();
                alert('å·²æ¢å¾©é è¨­è¨­å®šï¼');
            }
        }

        // ç³»çµ±åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    loadSettings();
     
    document.getElementById('barcodeInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            analyzeData();
        }
    });
    
    // è¨­ç½®æ‹–æ‹½åŠŸèƒ½ï¼ˆåƒ…é™QR Codeï¼‰
    setupDragAndDrop();
    
    // åˆå§‹åŒ–é è¨­è¼¸å…¥æ–¹å¼
    updateStatus('âœï¸ æ‰‹å‹•è¼¸å…¥æ¨¡å¼', '');
    
    // æ–°å¢ï¼šéŸ¿æ‡‰å¼åµæ¸¬ï¼Œç•¶è¦–çª—å¤§å°æ”¹è®Šæ™‚é‡æ–°æ¸²æŸ“è¨­å®šä»‹é¢
    window.addEventListener('resize', function() {
        if (document.getElementById('parameterRanges').innerHTML !== '') {
            updateParameterRangesUI();
        }
    });
});
    </script>
</body>
</html>
